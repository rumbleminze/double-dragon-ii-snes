; Bank 7


; C000 - bank 7
.byte $4C, $E6, $E2, $4C, $52, $D6, $4C, $20, $FC, $4C, $ED, $FE, $4C, $B0, $FC, $FF
.byte $01, $00, $00, $00, $00, $00, $03, $4C, $FF, $FF, $FF, $FF, $FF, $FC, $F2, $CB
.byte $A9, $00, $8D, $BB, $05, $8D, $BC, $05, $A0, $04, $99, $44, $06, $99, $4E, $06
.byte $99, $49, $06, $99, $53, $06, $88, $10, $F1, $8D, $80, $04, $8D, $81, $04, $8D
.byte $82, $04, $8D, $83, $04, $8D, $43, $06, $8D, $5E, $06, $8D, $5D, $06, $8D, $7A
.byte $03, $AD, $FF, $BF, $48, $AD, $D0, $00, $29, $F8, $8D, $D0, $00, $AD, $D0, $00
.byte $48, $AD, $D1, $00, $48, $AD, $D2, $00, $48, $AD, $D3, $00, $48, $AD, $D0, $00
.byte $85, $29, $AD, $D1, $00, $85, $2A, $AD, $D2, $00, $85, $2B, $AD, $D3, $00, $85
.byte $2C, $20, $AD, $C8, $A0, $05, $B1, $29, $8D, $9C, $04, $C8, $B1, $29, $8D, $9D
.byte $04, $C8, $B1, $29, $8D, $9E, $04, $C8, $B1, $29, $8D, $9F, $04, $20, $B4, $FE
.byte $A0, $02, $B1, $29, $C8, $11, $29, $D0, $08, $A5, $13, $20, $20, $CD, $4C, $1A
.byte $C1

    jslb set_ppu_mask_to_00, $a0
    nop
;   LDA #$00
;   STA PpuMask_2001


.byte $AD, $D0, $00, $8D, $D8, $00, $85, $29, $AD, $D1
.byte $00, $85, $2A, $18, $69, $01, $8D, $D1, $00, $8D, $D9, $00, $AD, $D2, $00, $8D
.byte $DA, $00, $AD, $D3, $00, $8D, $DB, $00, $A5, $29, $48, $A5, $2A, $48, $20, $4E
.byte $C1, $AD, $D0, $00, $38, $E9, $01, $8D, $D0, $00, $AD, $D1, $00, $E9, $00, $8D
.byte $D1, $00, $20, $70, $C6, $68, $85, $2A, $68, $85, $29, $A5, $2A, $CD, $D1, $00


; C100 - bank 7
.byte $D0, $D6, $A5, $29, $CD, $D0, $00, $D0, $CF, $20, $70, $C6, $AD, $BB, $05, $CD
.byte $BB, $05, $D0, $F5, $A9, $18, $05, $E8, $85, $E8, $A5, $3A, $49, $FF, $8D, $B2
.byte $05, $68, $8D, $D3, $00, $68, $8D, $D2, $00, $68, $8D, $D1, $00, $68, $8D, $D0
.byte $00, $68, $20, $1D, $FF, $AD, $D0, $00, $8D, $D8, $00, $AD, $D1, $00, $8D, $D9
.byte $00, $AD, $D2, $00, $8D, $DA, $00, $AD, $D3, $00, $8D, $DB, $00, $60, $AD, $FF
.byte $BF, $48, $20, $60, $C1, $20, $D0, $C3, $20, $96, $C5, $68, $20, $1D, $FF, $60
.byte $A9, $30, $20, $E6, $E2, $90, $03, $4C, $25, $C3, $AD, $D0, $00, $18, $69, $04
.byte $85, $29, $AD, $D1, $00, $69, $00, $85, $2A, $A5, $29, $29, $F8, $38, $ED, $D8
.byte $00, $85, $19, $A5, $2A, $ED, $D9, $00, $85, $1A, $05, $19, $D0, $03, $4C, $25
.byte $C3, $90, $2B, $24, $1A, $30, $27, $AD, $D8, $00, $85, $1A, $85, $29, $85, $2F
.byte $18, $69, $08, $8D, $D8, $00, $AD, $D9, $00, $85, $2A, $85, $30, $69, $00, $8D
.byte $D9, $00, $A5, $2A, $18, $69, $01, $85, $2A, $85, $30, $4C, $D9, $C1, $AD, $D8
.byte $00, $85, $29, $85, $2F, $85, $1A, $38, $E9, $08, $8D, $D8, $00, $AD, $D9, $00
.byte $85, $2A, $85, $30, $E9, $00, $8D, $D9, $00, $AD, $DA, $00, $18, $69, $EF, $85
.byte $2B, $AD, $DB, $00, $69, $00, $85, $2C, $20, $AD, $C8, $A0, $04, $B1, $29, $8D
.byte $8F, $04, $A0, $05, $B1, $29, $CD, $9C, $04, $F0, $18, $8D, $9C, $04, $C8, $B1


; C200 - bank 7
.byte $29, $8D, $9D, $04, $C8, $B1, $29, $8D, $9E, $04, $C8, $B1, $29, $8D, $9F, $04
.byte $20, $B4, $FE, $AD, $DA, $00, $85, $2B, $AD, $DB, $00, $85, $2C, $20, $94, $C3
.byte $A5, $1A, $4A, $4A, $4A, $85, $1A, $A4, $04, $A5, $05, $29, $01, $F0, $05, $A5
.byte $04, $69, $1E, $A8, $A5, $1A, $18, $79, $71, $C8, $85, $2B, $B9, $35, $C8, $69
.byte $00, $85, $2C, $AE, $BC, $05, $A5, $2C, $9D, $B1, $04, $E8, $A5, $2B, $9D, $B1
.byte $04, $E8, $A9, $04, $9D, $B1, $04, $E8, $A5, $27, $9D, $B1, $04, $E8, $A0, $09
.byte $B1, $29, $20, $1D, $FF, $A0, $00, $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C
.byte $A5, $24, $48, $A5, $24, $85, $06, $A5, $1A, $85, $07, $20, $26, $C3, $A4, $24
.byte $B1, $2B, $85, $2D, $C8, $B1, $2B, $85, $2E, $C8, $84, $24, $A4, $1A, $B1, $2D
.byte $9D, $B1, $04, $E8, $C6, $27, $D0, $DB, $68, $85, $24, $8E, $BC, $05, $A5, $28
.byte $D0, $03, $4C, $25, $C3, $A5, $2F, $85, $29, $A5, $30, $85, $2A, $AD, $DA, $00
.byte $85, $2B, $AD, $DB, $00, $85, $2C, $20, $AD, $C8, $A0, $3B, $A5, $05, $29, $01
.byte $D0, $02, $A0, $1D, $A5, $1A, $18, $79, $71, $C8, $85, $2B, $B9, $35, $C8, $85
.byte $2C, $69, $00, $AE, $BC, $05, $A5, $2C, $9D, $B1, $04, $E8, $A5, $2B, $9D, $B1
.byte $04, $E8, $A9, $04, $9D, $B1, $04, $E8, $A5, $28, $9D, $B1, $04, $E8, $A0, $00
.byte $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $A9, $00, $85, $24, $A5, $24, $85


; C300 - bank 7
.byte $06, $A5, $1A, $85, $07, $20, $26, $C3, $A4, $24, $B1, $2B, $85, $2D, $C8, $B1
.byte $2B, $85, $2E, $C8, $84, $24, $A4, $1A, $B1, $2D, $9D, $B1, $04, $E8, $C6, $28
.byte $D0, $DB, $8E, $BC, $05, $60, $98, $48, $A0, $02, $B1, $29, $85, $08, $C8, $B1
.byte $29, $85, $09, $A9, $00, $85, $0D, $A5, $05, $29, $01, $D0, $04, $A9, $40, $85
.byte $0D, $A5, $06, $29, $F8, $85, $0A, $A5, $07, $4A, $4A, $18, $65, $0A, $85, $0A
.byte $A5, $0A, $18, $65, $0D, $85, $0D, $A5, $06, $29, $02, $85, $0B, $A5, $07, $29
.byte $02, $4A, $05, $0B, $A8, $B9, $90, $C3, $85, $0B, $49, $FF, $85, $0C, $A4, $0A
.byte $A5, $0B, $31, $08, $85, $0E, $A4, $0D, $A5, $0C, $39, $BD, $05, $05, $0E, $99
.byte $BD, $05, $98, $29, $E0, $CD, $B1, $05, $B0, $03, $8D, $B1, $05, $68, $A8, $60
.byte $03, $0C, $30, $C0, $8A, $48, $46, $04, $46, $04, $46, $04, $A5, $04, $C9, $1E
.byte $90, $06, $E9, $1E, $A9, $30, $85, $23, $48, $85, $24, $A9, $1D, $38, $E5, $24
.byte $85, $24, $06, $24, $68, $18, $69, $01, $A2, $18, $86, $27, $A2, $00, $86, $28
.byte $C9, $18, $B0, $09, $85, $27, $A9, $18, $38, $E5, $27, $85, $28, $68, $AA, $60
.byte $A9, $30, $20, $E6, $E2, $90, $03, $4C, $95, $C5, $AD, $D2, $00, $29, $F8, $38
.byte $ED, $DA, $00, $85, $19, $AD, $D3, $00, $ED, $DB, $00, $85, $1A, $05, $19, $D0
.byte $03, $4C, $95, $C5, $24, $1A, $30, $2B, $AD, $DA, $00, $18, $69, $08, $8D, $DA


; C400 - bank 7
.byte $00, $85, $1A, $85, $2B, $AD, $DB, $00, $69, $00, $8D, $DB, $00, $85, $2C, $A5
.byte $2B, $18, $69, $EF, $85, $2B, $85, $2F, $A5, $2C, $69, $00, $85, $2C, $85, $30
.byte $4C, $49, $C4, $AD, $DA, $00, $38, $E9, $08, $85, $2B, $8D, $DA, $00, $AD, $DB
.byte $00, $E9, $00, $85, $2C, $8D, $DB, $00, $A5, $2B, $18, $69, $30, $85, $2B, $85
.byte $2F, $A5, $2C, $69, $00, $85, $2C, $85, $30, $AD, $D8, $00, $85, $29, $AD, $D9
.byte $00, $85, $2A, $20, $AD, $C8, $A0, $04, $B1, $29, $8D, $8F, $04, $A0, $05, $B1
.byte $29, $CD, $9C, $04, $F0, $18, $8D, $9C, $04, $C8, $B1, $29, $8D, $9D, $04, $C8
.byte $B1, $29, $8D, $9E, $04, $C8, $B1, $29, $8D, $9F, $04, $20, $B4, $FE, $AD, $D8
.byte $00, $4A, $4A, $4A, $85, $1A, $85, $28, $85, $27, $A9, $20, $38, $E5, $27, $85
.byte $27, $A5, $2F, $85, $2B, $A5, $30, $85, $2C, $20, $FE, $C8, $46, $04, $46, $04
.byte $46, $04, $A5, $04, $85, $24, $A5, $05, $29, $01, $F0, $07, $A5, $04, $18, $69
.byte $1E, $85, $04, $A5, $04, $85, $25, $A8, $A9, $1D, $38, $E5, $24, $85, $24, $06
.byte $24, $A5, $1A, $18, $79, $71, $C8, $85, $2B, $B9, $35, $C8, $69, $00, $AE, $BC
.byte $05, $9D, $B1, $04, $E8, $A5, $2B, $9D, $B1, $04, $E8, $A9, $00, $9D, $B1, $04
.byte $E8, $A5, $27, $9D, $B1, $04, $E8, $A0, $09, $B1, $29, $20, $1D, $FF, $A0, $00
.byte $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $A4, $24, $B1, $2B, $85, $2D, $C8


; C500 - bank 7
.byte $B1, $2B, $85, $2E, $A4, $1A, $A5, $24, $85, $06, $A5, $1A, $85, $07, $20, $26
.byte $C3, $A4, $1A, $B1, $2D, $C8, $84, $1A, $9D, $B1, $04, $E8, $C6, $27, $D0, $E6
.byte $8E, $BC, $05, $A5, $28, $F0, $6E, $A5, $2F, $85, $2B, $A5, $30, $85, $2C, $AD
.byte $D8, $00, $85, $29, $AD, $D9, $00, $18, $69, $01, $85, $2A, $20, $AD, $C8, $AE
.byte $BC, $05, $A4, $25, $B9, $35, $C8, $9D, $B1, $04, $E8, $B9, $71, $C8, $9D, $B1
.byte $04, $E8, $A9, $00, $9D, $B1, $04, $E8, $A5, $28, $9D, $B1, $04, $E8, $A0, $00
.byte $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $A4, $24, $B1, $2B, $85, $2D, $C8
.byte $B1, $2B, $85, $2E, $A0, $00, $84, $1A, $A5, $24, $85, $06, $A5, $1A, $85, $07
.byte $20, $26, $C3, $A4, $1A, $B1, $2D, $C8, $84, $1A, $9D, $B1, $04, $E8, $C6, $28
.byte $D0, $E6, $8E, $BC, $05, $60, $AD, $B1, $05, $30, $5C, $A9, $30, $20, $E6, $E2
.byte $B0, $55, $A9, $23, $85, $2A, $A9, $C0, $85, $29, $AD, $B1, $05, $C9, $40, $90
.byte $04, $A9, $2B, $85, $2A, $AD, $B1, $05, $29, $3F, $18, $65, $29, $85, $29, $A5
.byte $2A, $69, $00, $85, $2A, $AE, $BC, $05, $9D, $B1, $04, $E8, $A5, $29, $9D, $B1
.byte $04, $E8, $A9, $00, $9D, $B1, $04, $E8, $A9, $20, $9D, $B1, $04, $E8, $AC, $B1
.byte $05, $B9, $BD, $05, $9D, $B1, $04, $E8, $C8, $98, $29, $1F, $D0, $F3, $8C, $B1
.byte $05, $8E, $BC, $05, $4C, $96, $C5, $60, $03, $03, $03, $03, $03, $03, $02, $02


; C600 - bank 7
.byte $02, $02, $02, $02, $02, $02, $01, $01, $01, $01, $01, $01, $01, $01, $00, $00
.byte $00, $00, $00, $00, $00, $00, $0B, $0B, $0B, $0B, $0B, $0B, $0A, $0A, $0A, $0A
.byte $0A, $0A, $0A, $0A, $09, $09, $09, $09, $09, $09, $09, $09, $08, $08, $08, $08
.byte $08, $08, $08, $08, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40
.byte $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40
.byte $20, $00, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00
.byte $E0, $C0, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00

@video_ram_update_routine:
  LDA $19
  PHA
  LDA $1A
  PHA
  LDA $1B
  PHA
  LDA $1C
  PHA
  LDA #$78
  STA $1B
@vram_done_check:
  LDX $05BB
  CPX $05BC
  BEQ @done_vram_routine

  LDA RDNMI ; PpuStatus_2002
  jmp @check_for_attributes ; LDA $04B1,X
@check_for_attributes_return:  
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  INX
  AND #$F0
  CMP #$20
  BEQ :+
  CMP #$30
  BNE :++
: LDA $04B1,X
  STA VMADDL ; PpuAddr_2006
  INX
  LDA $E9
  AND #$FB
  ORA $04B1,X
  INX

  jslb update_ppu_control_from_a_and_store, $a0
  nops 1
;   STA $E9
;   STA PpuControl_2000

  LDA $04B1,X
  CMP #$21
  BCC :++
: .byte $80 
:
; c6b0
.byte $A8, $B9, $08, $C8, $85, $19, $B9, $E7
.byte $C7, $85, $1A, $BD, $B1, $04, $18, $69, $0E, $85, $1C, $A5, $1B, $38, $E5, $1C
.byte $85, $1B, $B0, $0D

@done_vram_routine:
  PLA
  STA $1C
  PLA
  STA $1B
  PLA
  STA $1A
  PLA
  STA $19
  RTS


; bigass unrolled loop
  INX
  JMP ($0019)
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  LDA $04B1,X
  STA VMDATAL ; PpuData_2007
  INX
  TXA
  PHA
  LDX $05BB
  LDA #$3F
  CMP $04B1,X
  BNE :+
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDA #$00
  STA VMADDL ; PpuAddr_2006
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  STA VMADDL ; PpuAddr_2006
: PLA
  TAX
  STX $05BB
  JMP $C683

; C7E7 - bank 7
.byte $00, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7
.byte $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7, $C7


; C800 - bank 7
.byte $C7, $C7, $C7, $C7, $C6, $C6, $C6, $C6, $00, $BE, $B7, $B0, $A9, $A2, $9B, $94
.byte $8D, $86, $7F, $78, $71, $6A, $63, $5C, $55, $4E, $47, $40, $39, $32, $2B, $24
.byte $1D, $16, $0F, $08, $01, $FA, $F3, $EC, $E5, $0A, $A8, $B9, $71, $C8, $48, $B9
.byte $35, $C8, $A8, $68, $60, $2B, $2B, $2B, $2B, $2B, $2B, $2A, $2A, $2A, $2A, $2A
.byte $2A, $2A, $2A, $29, $29, $29, $29, $29, $29, $29, $29, $28, $28, $28, $28, $28
.byte $28, $28, $28, $23, $23, $23, $23, $23, $23, $22, $22, $22, $22, $22, $22, $22
.byte $22, $21, $21, $21, $21, $21, $21, $21, $21, $20, $20, $20, $20, $20, $20, $20
.byte $20, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00, $E0
.byte $C0, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00, $A0
.byte $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00, $E0, $C0, $A0
.byte $80, $60, $40, $20, $00, $E0, $C0, $A0, $80, $60, $40, $20, $00, $98, $48, $A5
.byte $1A, $48, $A5, $19, $48, $A5, $29, $48, $A5, $2A, $48, $A5, $2B, $48, $A5, $2C
.byte $48, $20, $FE, $C8, $0A, $0A, $85, $19, $68, $85, $2C, $68, $85, $2B, $68, $85
.byte $2A, $68, $85, $29, $AD, $2A, $00, $18, $65, $19, $A8, $85, $19, $AD, $22, $04
.byte $0A, $A8, $B9, $33, $C9, $85, $06, $B9, $34, $C9, $85, $07, $A4, $19, $B1, $06
.byte $85, $13, $20, $97, $C9, $68, $85, $19, $68, $85, $1A, $68, $A8, $60, $A9, $00


; C900 - bank 7
.byte $85, $04, $85, $05, $A2, $09, $38, $A5, $2C, $E9, $F0, $85, $06, $A5, $04, $E9
.byte $00, $85, $07, $90, $08, $A5, $06, $85, $2C, $A5, $07, $85, $04, $26, $05, $06
.byte $2B, $26, $2C, $26, $04, $CA, $D0, $DE, $46, $04, $66, $2C, $A5, $2C, $85, $04
.byte $A5, $05, $60, $51, $C9, $5D, $C9, $67, $C9, $68, $C9, $78, $C9, $79, $C9, $83
.byte $C9, $87, $C9, $88, $C9, $89, $C9, $8A, $C9, $8B, $C9, $8C, $C9, $94, $C9, $94
.byte $C9, $01, $02, $03, $04, $01, $01, $07, $08, $01, $01, $05, $06, $0B, $0C, $30
.byte $30, $09, $2F, $0E, $0D, $0A, $0A, $00, $13, $13, $14, $16, $12, $11, $00, $00
.byte $0F, $10, $00, $00, $10, $10, $00, $00, $15, $18, $1B, $1C, $00, $17, $19, $1A
.byte $1D, $12, $1E, $21, $1F, $20, $00, $24, $25, $26, $25, $27, $00, $29, $29, $2A
.byte $22, $23, $28, $00, $2C, $2D, $2E, $85, $29, $A9, $00, $85, $2A, $A5, $2B, $48
.byte $A5, $2C, $48, $06, $29, $26, $2A, $A5, $29, $85, $2B, $A5, $2A, $85, $2C, $06
.byte $2B, $26, $2C, $06, $2B, $26, $2C, $A5, $2B, $18, $65, $29, $85, $29, $A5, $2C
.byte $65, $2A, $85, $2A, $A5, $29, $18, $69, $D8, $85, $29, $A5, $2A, $69, $C9, $85
.byte $2A, $68, $85, $2C, $68, $85, $2B, $60, $00, $10, $00, $00, $02, $08, $09, $0A
.byte $0B, $7C, $00, $80, $65, $89, $00, $00, $01, $02, $03, $00, $3C, $80, $A4, $8E
.byte $00, $00, $01, $02, $03, $00, $78, $80, $67, $8E, $00, $00, $01, $02, $03, $00


; CA00 - bank 7
.byte $B4, $80, $0D, $97, $00, $00, $01, $02, $03, $00, $F0, $80, $4A, $97, $00, $00
.byte $01, $02, $03, $00, $2C, $81, $8A, $97, $00, $00, $01, $02, $03, $00, $68, $81
.byte $C1, $9F, $00, $00, $01, $02, $03, $00, $A4, $81, $64, $9E, $00, $00, $01, $02
.byte $03, $00, $E0, $81, $1D, $A4, $01, $04, $05, $06, $07, $00, $1C, $82, $07, $87
.byte $01, $04, $05, $06, $07, $00, $58, $82, $DF, $A7, $01, $04, $05, $06, $07, $00
.byte $94, $82, $9B, $A8, $01, $04, $05, $06, $07, $00, $D0, $82, $20, $AA, $02, $08
.byte $09, $0A, $0B, $00, $0C, $83, $83, $AA, $01, $04, $05, $06, $07, $00, $48, $83
.byte $FB, $AB, $03, $0C, $0D, $0E, $0F, $00, $84, $83, $F7, $AE, $03, $0C, $0D, $0E
.byte $0F, $00, $C0, $83, $98, $B0, $03, $0C, $0D, $0E, $0F, $00, $F5, $97, $FA, $A9
.byte $0D, $20, $21, $22, $23, $01, $FC, $83, $D2, $B1, $03, $0C, $0D, $0E, $0F, $00
.byte $38, $84, $B3, $B5, $03, $0C, $0D, $0E, $0F, $00, $70, $11, $00, $00, $03, $0C
.byte $0D, $0E, $0F, $7C, $74, $84, $C5, $B9, $03, $0C, $0D, $0E, $0F, $00, $8D, $96
.byte $B5, $9E, $05, $10, $11, $12, $13, $01, $C9, $96, $60, $A7, $05, $10, $11, $12
.byte $13, $01, $05, $97, $D5, $A2, $05, $10, $11, $12, $13, $01, $41, $97, $C7, $BD
.byte $05, $10, $11, $12, $13, $01, $7D, $97, $AC, $A6, $05, $10, $11, $12, $13, $01
.byte $B9, $97, $50, $BA, $05, $10, $11, $12, $13, $01, $F5, $97, $FA, $A9, $05, $10


; CB00 - bank 7
.byte $11, $12, $13, $01, $31, $98, $76, $AA, $0D, $20, $21, $22, $23, $01, $6D, $98
.byte $5B, $AB, $06, $14, $15, $16, $17, $01, $A9, $98, $F0, $AC, $06, $14, $15, $16
.byte $17, $01, $E5, $98, $31, $A6, $06, $14, $15, $16, $17, $01, $21, $99, $52, $B6
.byte $0C, $1C, $1D, $1E, $1F, $01, $5D, $99, $13, $B6, $0C, $1C, $1D, $1E, $1F, $01
.byte $5B, $14, $00, $00, $07, $18, $19, $1A, $1B, $7C, $7E, $17, $00, $00, $08, $18
.byte $19, $1A, $1B, $7C, $1F, $19, $00, $00, $09, $18, $19, $1A, $1B, $7C, $F7, $1B
.byte $00, $00, $0B, $18, $19, $1A, $1B, $7C, $99, $99, $14, $BC, $0C, $1C, $1D, $1E
.byte $1F, $01, $D5, $99, $45, $BE, $0C, $1C, $1D, $1E, $1F, $01, $11, $9A, $BE, $BF
.byte $0C, $1C, $1D, $1E, $1F, $01, $00, $10, $00, $00, $11, $24, $25, $26, $27, $78
.byte $EC, $84, $62, $BB, $0E, $28, $29, $2A, $2B, $00, $28, $85, $A2, $BA, $0E, $28
.byte $29, $2A, $2B, $00, $64, $85, $87, $BF, $0E, $28, $29, $2A, $2B, $00, $B0, $84
.byte $07, $87, $01, $04, $05, $06, $07, $00, $0C, $83, $83, $AA, $02, $08, $09, $0A
.byte $0B, $00, $56, $16, $00, $00, $1C, $30, $31, $32, $33, $74, $65, $18, $00, $00
.byte $1B, $2C, $2D, $2E, $2F, $74, $BB, $19, $00, $00, $1B, $2C, $2D, $2E, $2F, $74
.byte $05, $1C, $00, $00, $1B, $2C, $2D, $2E, $2F, $74, $76, $1A, $00, $00, $1A, $2C
.byte $2D, $2E, $2F, $74, $94, $17, $00, $00, $1B, $2C, $2D, $2E, $2F, $74, $EB, $17


; CC00 - bank 7
.byte $00, $00, $1B, $2C, $2D, $2E, $2F, $74, $73, $15, $00, $00, $19, $6E, $6F, $70
.byte $71, $74, $4F, $14, $00, $00, $18, $6E, $6F, $70, $71, $74, $3C, $18, $00, $00
.byte $18, $6E, $6F, $70, $71, $74, $0F, $1D, $00, $00, $27, $66, $67, $68, $69, $78
.byte $04, $1E, $00, $00, $24, $66, $67, $68, $69, $78, $E5, $17, $00, $00, $29, $6A
.byte $6B, $6C, $6D, $78, $F2, $18, $00, $00, $29, $6A, $6B, $6C, $6D, $78, $39, $19
.byte $00, $00, $29, $6A, $6B, $6C, $6D, $78, $CA, $19, $00, $00, $29, $6A, $6B, $6C
.byte $6D, $78, $A5, $11, $00, $00, $20, $3C, $3D, $3E, $3F, $74, $B4, $11, $00, $00
.byte $1F, $3C, $3D, $3E, $3F, $78, $23, $13, $00, $00, $23, $38, $39, $3A, $3B, $74
.byte $1B, $1D, $00, $00, $26, $66, $67, $68, $69, $74, $BC, $1E, $00, $00, $22, $38
.byte $39, $3A, $3B, $7C, $C0, $14, $00, $00, $1D, $34, $35, $36, $37, $78, $FD, $15
.byte $00, $00, $1D, $34, $35, $36, $37, $78, $FE, $16, $00, $00, $1D, $34, $35, $36
.byte $37, $78, $DA, $1B, $00, $00, $27, $66, $67, $68, $69, $78, $2B, $1C, $00, $00
.byte $25, $66, $67, $68, $69, $78, $3F, $1A, $00, $00, $2B, $6A, $6B, $6C, $6D, $78
.byte $84, $1A, $00, $00, $2B, $6A, $6B, $6C, $6D, $78, $03, $1B, $00, $00, $2A, $6A
.byte $6B, $6C, $6D, $78, $00, $10, $00, $00, $23, $38, $39, $3A, $3B, $74, $5D, $10
.byte $00, $00, $21, $38, $39, $3A, $3B, $74, $35, $13, $00, $00, $1D, $34, $35, $36


; CD00 - bank 7
.byte $37, $78, $E4, $13, $00, $00, $1D, $34, $35, $36, $37, $78, $D3, $1D, $00, $00
.byte $2C, $30, $31, $32, $33, $74, $D8, $1E, $00, $00, $31, $5C, $5D, $5E, $5F, $74

; cd20
  STA $19
  LDA $BFFF
  PHA
  JSR $FCC0
  JSR $FEA8
  LDA $E9
  AND #$FB
  jslb update_ppu_control_from_a_and_store, $a0
;   nops 1
;   STA $E9
;   STA PpuControl_2000
  LDA #$00
  jslb update_ppu_mask_and_store, $a0
;   nops 1
;   LDA #$00
;   STA PpuMask_2001

.byte $A5, $19, $20, $97, $C9, $A0
.byte $09, $B1, $29, $C9, $06, $90, $1F, $AA, $AD, $98, $04, $48, $8E, $98, $04, $E8
.byte $E8, $AD, $99, $04, $48, $8E, $99, $04, $20, $ED, $FE, $68, $8D, $99, $04, $68
.byte $8D, $98, $04, $4C, $69, $CD, $20, $1D, $FF, $A0, $04, $B1, $29, $8D, $8F, $04
.byte $A0, $05, $B1, $29, $8D, $9C, $04, $C8, $B1, $29, $8D, $9D, $04, $C8, $B1, $29
.byte $8D, $9E, $04, $C8, $B1, $29, $8D, $9F, $04, $A0, $00, $B1, $29, $48, $C8, $B1
.byte $29, $85, $2A, $68, $85, $29, $A9, $20, $85, $2C, $A9, $00, $85, $2B, $85, $19

; hijacked
  ; JSR $CDC6
  JSR @cdc6_hijack

.byte $20, $B4, $FE, $68, $20, $1D, $FF, $20, $ED, $FE, $A9, $FF, $8D
.byte $40, $06, $A9, $80, $8D, $3F, $06, $20, $C0, $FC, $A5, $E8, $09, $18, $85, $E8
.byte $A9, $80, $8D, $B1, $05, $60, $20, $AF, $CE, $A5, $1A, $D0, $45, $20, $AF, $CE
.byte $A5, $1A, $D0, $01, $60, $29, $F0, $C9, $20, $D0, $0F, $A5, $1A, $85, $2C, $20
.byte $AF, $CE, $85, $2B, $20, $9D, $CE, $4C, $C6, $CD, $A5, $29, $48, $A5, $2A, $48
.byte $A6, $1A, $20, $AF, $CE, $86, $2A, $85, $29, $A5, $19, $48, $A9, $00, $85, $19


; CE00 - bank 7
.byte $20, $C6, $CD, $68, $85, $19, $68, $85, $2A, $68, $85, $29, $20, $9D, $CE, $4C
.byte $C6, $CD, $A2, $05, $29, $C0, $4A, $CA, $D0, $FC, $AA, $BD, $28, $CE, $85, $2D
.byte $BD, $29, $CE, $85, $2E, $6C, $2D, $00, $30, $CE, $41, $CE, $55, $CE, $75, $CE
.byte $A6, $1A, $20, $AF, $CE, $20, $E0, $CE, $CA, $D0, $FA, $20, $9D, $CE, $4C, $C6
.byte $CD, $A5, $1A, $29, $3F, $AA, $20, $AF, $CE, $20, $E0, $CE, $CA, $D0, $F7, $20
.byte $9D, $CE, $4C, $C6, $CD, $A5, $1A, $29, $3F, $85, $1C, $20, $AF, $CE, $85, $1B
.byte $20, $AF, $CE, $A6, $1C, $20, $E0, $CE, $CA, $D0, $FA, $C6, $1B, $D0, $F4, $20
.byte $9D, $CE, $4C, $C6, $CD, $A5, $1A, $29, $3F, $85, $1C, $20, $AF, $CE, $85, $1B
.byte $A5, $19, $85, $1D, $A5, $1D, $85, $19, $A6, $1C, $20, $AF, $CE, $20, $E0, $CE
.byte $CA, $D0, $F7, $C6, $1B, $D0, $ED, $20, $9D, $CE, $4C, $C6, $CD, $A5, $29, $18
.byte $65, $19, $85, $29, $A9, $00, $65, $2A, $85, $2A, $A9, $00, $85, $19, $60

  LDA $2A
  CMP #$80
  BCS @ced7
  LDA $19
  CLC
  ADC $29
  STA $2D
  LDA $2A
;   ADC #$00
  ADC #$30 ; we use $4000 for the first sprites, instead of $1000
  STA $2E
  LDA $2E
  STA VMADDH ; PpuAddr_2006
  LDA $2D
  STA VMADDL ; PpuAddr_2006
  LDA VMDATALREAD ; PpuData_2007
  LDA VMDATALREAD ; PpuData_2007
  STA $1A
  INC $19
  RTS

@ced7:
  LDY $19
  LDA ($29),Y
  STA $1A
  INC $19
  RTS

.byte $A5, $2C, $29, $03, $C9, $03, $D0, $2C, $A5, $2B, $C9, $C0, $90, $26, $A5, $19
.byte $48, $98, $48, $A5, $2B, $38, $E9, $C0, $85, $19, $A5, $2C, $C9, $23, $F0, $07


; CF00 - bank 7
.byte $18, $A9, $40, $65, $19, $85, $19, $A5, $19, $A8, $A5, $1A, $99, $BD, $05, $68
.byte $A8, $68, $85, $19

  LDA $2C
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDA $2B
  STA VMADDL ; PpuAddr_2006
  LDA $1A
  STA VMDATAL ; PpuData_2007

.byte $18, $A5, $2B, $69, $01, $85, $2B, $A5, $2C, $69, $00, $85, $2C
.byte $60, $A9, $00, $8D, $44, $06, $A9, $04, $8D, $45, $06, $60, $AD, $D0, $00, $48
.byte $AD, $D1, $00, $48, $AD, $D8, $00, $48, $AD, $D9, $00, $48, $AD, $44, $06, $8D
.byte $D8, $00, $AD, $45, $06, $8D, $D9, $00, $AD, $F5, $00, $8D, $D0, $00, $A9, $04
.byte $8D, $D1, $00, $20, $4E, $C1, $AD, $D8, $00, $8D, $44, $06, $AD, $D9, $00, $8D
.byte $45, $06, $68, $8D, $D9, $00, $68, $8D, $D8, $00, $68, $8D, $D1, $00, $68, $8D
.byte $D0, $00, $60, $A9, $00, $8D, $44, $06, $8D, $45, $06, $60, $AD, $45, $06, $D0
.byte $F1, $AD, $D0, $00, $48, $AD, $D1, $00, $48, $AD, $D8, $00, $48, $AD, $D9, $00
.byte $48, $AD, $44, $06, $8D, $D8, $00, $AD, $45, $06, $8D, $D9, $00, $AD, $F5, $00
.byte $8D, $D0, $00, $A9, $00, $8D, $D1, $00, $4C, $63, $CF, $A9, $02, $8D, $44, $06
.byte $8D, $45, $06, $60, $AD, $D0, $00, $48, $AD, $D1, $00, $48, $AD, $D8, $00, $48
.byte $AD, $D9, $00, $48, $AD, $D2, $00, $48, $AD, $D3, $00, $48, $AD, $DA, $00, $48
.byte $AD, $DB, $00, $48, $A9, $00, $8D, $D2, $00, $8D, $D3, $00, $8D, $DA, $00, $8D
.byte $DB, $00, $AD, $44, $06, $8D, $D8, $00, $AD, $45, $06, $8D, $D9, $00, $AD, $F5


; D000 - bank 7
.byte $00, $8D, $D0, $00, $A9, $02, $8D, $D1, $00, $20, $4E, $C1, $AD, $D8, $00, $8D
.byte $44, $06, $AD, $D9, $00, $8D, $45, $06, $68, $8D, $DB, $00, $68, $8D, $DA, $00
.byte $68, $8D, $D3, $00, $68, $8D, $D2, $00, $68, $8D, $D9, $00, $68, $8D, $D8, $00
.byte $68, $8D, $D1, $00, $68, $8D, $D0, $00, $60, $EE, $60, $06, $AD, $60, $06, $29
.byte $01, $D0, $51, $AD, $5F, $06, $F0, $4C, $AD, $5F, $06, $29, $7F, $C9, $01, $D0
.byte $0D, $AD, $D2, $00, $38, $E9, $B0, $AD, $D3, $00, $E9, $00, $B0, $36, $AD, $5E
.byte $06, $10, $05, $A9, $02, $8D, $5E, $06, $C9, $03, $90, $05, $A9, $00, $8D, $5E
.byte $06, $AD, $5F, $06, $29, $7F, $85, $19, $0A, $18, $65, $19, $6D, $5E, $06, $A8
.byte $B9, $92, $D0, $8D, $8F, $04, $EE, $5E, $06, $AD, $5F, $06, $10, $06, $CE, $5E
.byte $06, $CE, $5E, $06, $60, $05, $12, $13, $15, $14, $0D, $04, $16, $17, $02, $63
.byte $A5, $F1, $C9, $01, $F0, $01, $60


; d0a7 shuffle sprites - we don't need to do this, so we just always skip it
  rts
  nops 1
  ;LDA $19
  PHA
  LDA $1A
  PHA
  LDY #$00
  STY $19
  LDA #$FF
  STA $1A
  LDX #$06
: LDA $3C,X
  BPL :++
  INY
  LDA $4A,X
  AND #$20
  BNE :++
  LDA $92,X
  CMP $19
  BCC :+
  STA $19
: CMP $1A
  BCS :+
  STA $1A
: DEX
  BPL :---
  CPY #$03
  BCC @d132
  LDA $19
  SEC
  SBC $1A
  BCC @d132
  CMP #$0A
  BCS @d132

  LDA #$20
  STA $19
  LDX #$00
  LDY #$FC
: LDA $0200,Y
  PHA
  LDA $0200,X
  STA $0200,Y
  PLA
  STA $0200,X
  INY
  INX
  LDA $0200,Y
  PHA
  LDA $0200,X
  STA $0200,Y
  PLA
  STA $0200,X
  INX
  INY
  LDA $0200,Y
  PHA
  LDA $0200,X
  STA $0200,Y
  PLA
  STA $0200,X
  INX
  INY
  LDA $0200,Y
  PHA
  LDA $0200,X
  STA $0200,Y
  PLA
  STA $0200,X
  INX
  TYA
  SEC
  SBC #$07
  TAY
  DEC $19
  BNE :-
@d132:

; D132 - bank 7
.byte $68, $85, $1A, $68, $85, $19, $60, $F7, $1B, $00, $4B, $E3, $D7, $D0
.byte $A2, $01, $A0, $01, $BD, $3C, $00, $10, $03, $4C, $CF, $D1, $BD, $32, $04, $F0
.byte $7E, $BD, $CC, $03, $D0, $05, $A9, $00, $99, $CC, $03, $FE, $CC, $03, $BD, $CC
.byte $03, $C9, $15, $90, $6A, $20, $D9, $D1, $B0, $65, $8A, $48, $20, $FF, $D1, $68
.byte $AA, $A8, $DE, $CC, $03, $A5, $09, $30, $56, $FE, $CC, $03, $99, $59, $03, $A5
.byte $0A, $95, $77, $A5, $0B, $95, $80, $A5, $0C, $95, $92, $A5, $0D, $95, $9B, $A5
.byte $0E, $95, $AD, $A5, $0F, $95, $B6, $A9, $80, $95, $3C, $A9, $08, $95, $4A, $A9
.byte $25, $95, $43, $A9, $7F, $99, $1E, $04, $A9, $7F, $95, $C7, $9D, $CE, $03, $A9
.byte $00, $9D, $4A, $04, $9D, $46, $04, $AD, $22, $04, $A8, $B9, $BC, $D5, $18, $65
.byte $09, $A8, $B9, $CB, $D5, $F0, $08, $A9, $F4, $95, $77, $A9, $00, $95, $80, $8A
.byte $A8, $88, $CA, $30, $03, $4C, $44, $D1, $60, $8A, $48, $A5, $3C, $45, $3D, $29
.byte $80, $10, $14, $A2, $00, $A5, $3C, $30, $02, $A2, $01, $B5, $43, $29, $7F, $C9
.byte $03, $90, $04, $C9, $06, $90, $04, $18, $68, $AA, $60, $38, $68, $AA, $60, $A9


; D200 - bank 7
.byte $FF, $A2, $10, $95, $04, $CA, $10, $FB, $AD, $D0, $00, $18, $69, $80, $85, $10
.byte $AD, $D1, $00, $69, $00, $85, $11, $AD, $D2, $00, $18, $69, $74, $85, $12, $AD
.byte $D3, $00, $69, $00, $85, $13, $AC, $22, $04, $B9, $AD, $D5, $85, $1A, $A9, $00
.byte $85, $19, $AD, $FF, $BF, $48, $A9, $04, $20, $1D, $FF, $AD, $22, $04, $0A, $A8
.byte $B9, $21, $8B, $85, $29, $B9, $22, $8B, $85, $2A, $AC, $22, $04, $B9, $BC, $D5
.byte $18, $65, $19, $A8, $B9, $CB, $D5, $30, $33, $A0, $04, $B1, $29, $29, $7F, $C9
.byte $00, $F0, $0B, $C9, $03, $F0, $07, $C9, $08, $F0, $03, $4C, $8C, $D2, $A0, $00
.byte $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $C8, $B1, $29, $85, $1B, $C8, $B1
.byte $29, $85, $1C, $A9, $00, $85, $1F, $85, $20, $20, $A7, $D2, $A5, $29, $18, $69
.byte $05, $85, $29, $A5, $2A, $69, $00, $85, $2A, $E6, $19, $C6, $1A, $D0, $AB, $68
.byte $20, $1D, $FF, $A5, $09, $0A, $60, $A0, $00, $A5, $1F, $85, $1D, $A5, $20, $85
.byte $1E, $B1, $2B, $85, $1F, $48, $C8, $B1, $2B, $85, $20, $48, $C8, $B1, $2B, $85
.byte $2D, $C8, $B1, $2B, $85, $2E, $20, $20, $D4, $A5, $1B, $18, $65, $21, $85, $21
.byte $A5, $1C, $65, $22, $85, $22, $A5, $1B, $18, $65, $23, $85, $23, $A5, $1C, $65
.byte $24, $85, $24, $A5, $D0, $38, $E5, $1D, $A5, $D1, $E5, $1E, $B0, $07, $C9, $FF
.byte $F0, $0B, $4C, $03, $D4, $A5, $D0, $85, $1D, $A5, $D1, $85, $1E, $A5, $1F, $85


; D300 - bank 7
.byte $25, $38, $E5, $D0, $A5, $20, $85, $26, $E5, $D1, $B0, $03, $4C, $03, $D4, $F0
.byte $09, $A5, $D0, $85, $25, $A6, $D1, $E8, $86, $26, $A5, $D2, $38, $E5, $23, $A5
.byte $D3, $E5, $24, $B0, $07, $C9, $FF, $F0, $0B, $4C, $03, $D4, $A5, $D2, $85, $23
.byte $A5, $D3, $85, $24, $A5, $21, $38, $E5, $D2, $A5, $22, $E5, $D3, $B0, $03, $4C
.byte $03, $D4, $F0, $0D, $A5, $D2, $18, $69, $F0, $85, $21, $A5, $D3, $69, $00, $85
.byte $22, $A5, $1D, $18, $65, $25, $85, $1D, $A5, $1E, $65, $26, $85, $1E, $46, $1E
.byte $66, $1D, $A5, $21, $18, $65, $23, $85, $21, $A5, $22, $65, $24, $85, $22, $46
.byte $22, $66, $21, $A5, $10, $38, $E5, $1D, $85, $25, $A5, $11, $E5, $1E, $85, $26
.byte $B0, $0D, $A5, $1D, $38, $E5, $10, $85, $25, $A5, $1E, $E5, $11, $85, $26, $D0
.byte $72, $A5, $25, $38, $E9, $60, $B0, $6B, $A5, $12, $38, $E5, $21, $85, $27, $A5
.byte $13, $E5, $22, $85, $28, $B0, $0D, $A5, $21, $38, $E5, $12, $85, $27, $A5, $22
.byte $E5, $13, $85, $28, $D0, $4D, $A5, $27, $38, $E9, $40, $B0, $46, $20, $79, $D6
.byte $A5, $04, $38, $E5, $25, $A5, $05, $E5, $26, $90, $38, $A5, $21, $E5, $1B, $85
.byte $21, $A5, $22, $E5, $1C, $85, $22, $A5, $19, $85, $09, $A5, $1D, $85, $0A, $A5
.byte $1E, $85, $0B, $A5, $21, $85, $0C, $A5, $22, $85, $0D, $A5, $1B, $85, $0E, $A5
.byte $1C, $85, $0F, $A5, $25, $85, $04, $A5, $26, $85, $05, $A5, $27, $85, $06, $A5


; D400 - bank 7
.byte $28, $85, $07, $68, $85, $20, $68, $85, $1F, $A0, $01, $B1, $2B, $10, $01, $60
.byte $A5, $2B, $18, $69, $04, $85, $2B, $A5, $2C, $69, $00, $85, $2C, $4C, $A7, $D2
.byte $A0, $00, $B1, $2D, $30, $1F, $85, $2F, $A0, $06, $B1, $2D, $10, $02, $A9, $00
.byte $06, $2F, $06, $2F, $05, $2F, $0A, $A8, $B9, $46, $D4, $85, $2F, $B9, $47, $D4
.byte $85, $30, $6C, $2F, $00, $60, $66, $D4, $7F, $D4, $AC, $D4, $D9, $D4, $E7, $D4
.byte $15, $D5, $38, $D5, $38, $D5, $38, $D5, $55, $D5, $55, $D5, $78, $D5, $78, $D5
.byte $84, $D5, $84, $D5, $84, $D5, $A0, $01, $B1, $2D, $85, $21, $C8, $B1, $2D, $85
.byte $22, $A0, $07, $B1, $2D, $85, $23, $C8, $B1, $2D, $85, $24, $4C, $9D, $D5, $A0
.byte $01, $B1, $2D, $85, $21, $C8, $B1, $2D, $85, $22, $A0, $07, $18, $B1, $2D, $65
.byte $1D, $85, $23, $C8, $B1, $2D, $65, $1E, $85, $24, $88, $A5, $21, $38, $F1, $2D
.byte $85, $1F, $C8, $A5, $22, $F1, $2D, $85, $20, $4C, $9D, $D5, $A0, $01, $B1, $2D
.byte $85, $21, $C8, $B1, $2D, $85, $22, $A0, $07, $B1, $2D, $38, $E5, $1F, $85, $23
.byte $C8, $B1, $2D, $E5, $20, $85, $24, $88, $B1, $2D, $38, $E5, $21, $85, $1D, $C8
.byte $B1, $2D, $E5, $22, $85, $1E, $4C, $9D, $D5, $A0, $07, $B1, $2D, $85, $1D, $C8
.byte $B1, $2D, $85, $1E, $4C, $9D, $D5, $A0, $01, $B1, $2D, $18, $65, $1F, $85, $21
.byte $C8, $B1, $2D, $65, $20, $85, $22, $A0, $07, $B1, $2D, $85, $23, $C8, $B1, $2D


; D500 - bank 7
.byte $85, $24, $A0, $01, $A5, $23, $38, $F1, $2D, $85, $1D, $C8, $A5, $24, $F1, $2D
.byte $85, $1E, $4C, $9D, $D5, $A0, $01, $B1, $2D, $18, $65, $1D, $85, $23, $C8, $B1
.byte $2D, $65, $1E, $85, $24, $A0, $07, $B1, $2D, $18, $65, $1F, $85, $21, $C8, $B1
.byte $2D, $65, $20, $85, $22, $4C, $9D, $D5, $A0, $01, $B1, $2D, $38, $E5, $1D, $85
.byte $21, $C8, $B1, $2D, $E5, $1E, $85, $22, $A0, $07, $B1, $2D, $85, $23, $B1, $2D
.byte $85, $23, $4C, $9D, $D5, $A0, $01, $B1, $2D, $38, $E5, $1F, $85, $23, $C8, $B1
.byte $2D, $E5, $20, $85, $24, $A0, $07, $B1, $2D, $38, $E5, $1D, $85, $21, $C8, $B1
.byte $2D, $E5, $1E, $85, $22, $4C, $9D, $D5, $A0, $01, $B1, $2D, $85, $1F, $C8, $B1
.byte $2D, $85, $20, $60, $A0, $01, $B1, $2D, $85, $1F, $C8, $B1, $2D, $85, $20, $A0
.byte $07, $B1, $2D, $85, $1D, $C8, $B1, $2D, $85, $1E, $4C, $9D, $D5, $A9, $0C, $18
.byte $65, $2D, $85, $2D, $A9, $00, $65, $2E, $85, $2E, $4C, $20, $D4, $06, $09, $02
.byte $03, $06, $10, $10, $01, $02, $01, $02, $01, $02, $01, $01, $00, $06, $0E, $11
.byte $14, $1A, $2A, $3A, $3B, $3D, $3E, $40, $41, $43, $44, $00, $00, $00, $00, $00
.byte $00, $00, $00, $FF, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
.byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
.byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $FF, $FF, $FF, $FF, $00, $00, $FF


; D600 - bank 7
.byte $FF, $FF, $FF, $00, $00, $00, $01, $00, $00, $01, $00, $00, $00, $00, $00, $00
.byte $02, $80, $46, $C1, $C2, $C3, $C4, $C5, $B6, $18, $00, $04, $80, $44, $60, $61
.byte $70, $C6, $81, $AD, $00, $43, $04, $15, $CF, $04, $55, $44, $51, $00, $21, $88
.byte $04, $55, $44, $15, $00, $02, $0A, $04, $55, $42, $11, $44, $03, $55, $45, $11
.byte $A5, $29, $49, $FF, $18, $69, $01, $85, $29, $A5, $2A, $49, $FF, $69, $00, $85
.byte $2A, $60, $A5, $19, $48, $A5, $1A, $48, $84, $1A, $86, $19, $A2, $08, $A9, $00
.byte $06, $19, $2A, $C5, $1A, $90, $02, $E5, $1A, $26, $19, $CA, $D0, $F4, $AA, $A4
.byte $19, $68, $85, $1A, $68, $85, $19, $98, $60, $A5, $25, $20, $99, $D6, $A5, $2D
.byte $85, $2F, $A5, $2E, $85, $30, $A5, $27, $20, $99, $D6, $A5, $2D, $18, $65, $2F
.byte $85, $25, $A5, $2E, $65, $30, $85, $26, $60, $AA, $A5, $2F, $48, $A5, $30, $48
.byte $86, $2F, $A9, $00, $85, $2D, $85, $2E, $85, $30, $A5, $2F, $05, $30, $F0, $19
.byte $8A, $4A, $AA, $90, $0D, $A5, $2F, $18, $65, $2D, $85, $2D, $A5, $30, $65, $2E
.byte $85, $2E, $06, $2F, $26, $30, $4C, $AA, $D6, $68, $85, $30, $68, $85, $2F, $60
.byte $AD, $3F, $06, $30, $6B, $A9, $38, $20, $E6, $E2, $B0, $64, $AD, $3F, $06, $29
.byte $01, $D0, $31, $AD, $40, $06, $10, $05, $A9, $00, $8D, $40, $06, $AD, $40, $06
.byte $29, $0F, $D0, $03, $20, $41, $D7, $AD, $40, $06, $18, $69, $08, $8D, $40, $06


; D700 - bank 7
.byte $C9, $4F, $90, $3C, $A9, $FF, $8D, $40, $06, $AD, $3F, $06, $09, $80, $8D, $3F
.byte $06, $4C, $40, $D7, $AD, $40, $06, $10, $05, $A9, $30, $8D, $40, $06, $AD, $40
.byte $06, $29, $0F, $D0, $03, $20, $41, $D7, $AD, $40, $06, $38, $E9, $08, $8D, $40
.byte $06, $B0, $0D, $A9, $FF, $8D, $40, $06, $AD, $3F, $06, $09, $80, $8D, $3F, $06
.byte $60

; d741 - lots of loading info, we need to hijack some palette updates
  LDA $048F
  STA $0491
  ASL A
  TAX
  LDA $E2FA,X
  STA $29
  LDA $E2FB,X
  STA $2A
  LDX $05BC
  LDA #$3F
  STA $04B1,X
  INX
  LDA #$00
  STA $04B1,X
  INX
  LDA #$00
  STA $04B1,X
  INX
  LDA #$10
  STA $04B1,X
  INX
  LDY #$00
: LDA $0640
  BNE :+
  LDA #$0F
  JMP $D78C
: LDA ($29),Y
  CMP $0640
  BCC :+
  AND #$0F
  STA $19
  LDA $0640
  SBC #$10
  ORA $19
: STA PALETTE_UPDATE_START, Y ; $04B1,X
  INX
  INY
  CPY #$10
  BCC :---
  STX $05BC
  LDA $063F
  AND #$02
  BNE @palette_2_early_rts
  LDA $0490
  STA $0492
  ASL A
  TAX
  LDA $E360,X
  STA $29
  LDA $E361,X
  STA $2A
  LDX $05BC
  LDA #$3F
  STA $04B1,X
  INX
  LDA #$10
  STA $04B1,X
  INX
  LDA #$00
  STA $04B1,X
  INX
  LDA #$10
  STA $04B1,X
  INX
  LDY #$00
: LDA $0640
  BNE :+ 
  LDA #$0F
  JMP $D7EA
: LDA ($29),Y
  CMP $0640
  BCC :+
  AND #$0F
  STA $19
  LDA $0640
  SBC #$10
  ORA $19
: STA PALETTE_UPDATE_START + $10, Y ; $04B1,X
  INX
  INY
  CPY #$10
  BCC :---
@palette_2_early_rts:
  jsr @finish_palette_updates ; STX $05BC
  RTS

.byte $A2, $00, $A9, $00, $95, $00, $E8, $E0, $DD


; D800 - bank 7
.byte $90, $F9, $60, $A9, $00, $85, $29, $A9, $03, $85, $2A, $A2, $00, $A9, $00, $81
.byte $29, $E6, $29, $D0, $02, $E6, $2A, $A5, $2A, $CD, $27, $D8, $D0, $EF, $A5, $29
.byte $CD, $26, $D8, $D0, $E8, $60, $86, $04, $AE, $A7, $04, $F0, $10, $A9, $F0, $E0
.byte $04, $F0, $0A, $9D, $00, $02, $CA, $CA, $CA, $CA, $4C, $2F, $D8, $60

; move all sprites to F0

;   LDX #$FC
;   LDA #$F0
;   STA $0200,X
;   CPX #$00
;   BEQ :+
;   DEX
;   DEX
;   DEX
;   DEX
;   JMP $D842
; : 
  jslb move_sprites_offscreen, $a0
  RTS

; hijack of cdc6 so we can update attributes after it
@cdc6_hijack:
  jsr $CDC6
  jslb double_dragon_2_full_attribute_write, $a0
  rts

  nops 6


; D851 - zero out VRAM
; DD2 does this via several calls and loops, but we can just clear it 
; all via DMA
jslb clear_bg_jsl, $a0
RTS

@finish_palette_updates:
  STX $05BC
  LDA #$01
  STA PALETTE_UPDATE_START - 1
  nops 4 ; jslb check_for_palette_updates, $a0
  RTS

nops 2
;   LDA #$20
;   LDY #$00
;   LDX #$00
;   JSR $FD10
;   LDA #$24
;   JSR $FD10
;   LDA #$28
;   JSR $FD10
; D865 - handle hiding/showing left 8 most pixels
  LDA $E8
  ORA #$02
  BNE :+
  LDA $E8
  AND #$F9
:
  jslb update_ppu_mask_and_store, $a0  
  nops 1
;   STA $E8
;   STA PpuMask_2001
  RTS


.byte $20, $D3, $FC, $20, $51, $D8, $20, $3E, $D8, $20, $52
.byte $FE, $60, $A9, $00, $85, $1C, $A2, $00, $BD, $3C, $00, $30, $01, $E8, $B5, $77
.byte $85, $29, $B5, $80, $85, $2A, $E0, $00, $D0, $46, $E8, $BD, $3C, $00, $10, $40
.byte $A5, $29, $38, $F5, $77, $85, $29, $A5, $2A, $F5, $80, $85, $2A, $10, $03, $20
.byte $40, $D6, $46, $2A, $66, $29, $A2, $00, $A5, $77, $38, $E5, $78, $A5, $80, $E5
.byte $81, $30, $01, $E8, $B5, $77, $18, $65, $29, $85, $29, $B5, $80, $65, $2A, $85
.byte $2A, $A5, $29, $38, $E9, $80, $85, $29, $A5, $2A, $E9, $00, $85, $2A, $C6, $1C
.byte $A5, $29, $38, $E5, $D0, $85, $19, $A5, $2A, $E5, $D1, $85, $1A, $30, $0C, $D0
.byte $14, $24, $1C, $30, $10, $A5, $19, $C9, $40, $B0, $04, $A0, $00, $F0, $08, $A5


; D900 - bank 7
.byte $19, $C9, $C0, $90, $08, $A0, $03, $20, $0E, $D9, $20, $2D, $D9, $60, $24, $1C
.byte $30, $0F, $A5, $29, $38, $F9, $27, $D9, $85, $29, $A5, $2A, $F9, $28, $D9, $85
.byte $2A, $B9, $29, $D9, $85, $19, $60, $40, $00, $FC, $C0, $00, $04, $A5, $19, $18
.byte $08, $65, $D0, $85, $D0, $A5, $D1, $69, $00, $28, $10, $02, $69, $FF, $85, $D1
.byte $A5, $D0, $38, $E5, $29, $85, $1B, $A5, $D1, $E5, $2A, $10, $0F, $48, $A5, $1B
.byte $49, $FF, $18, $69, $01, $85, $1B, $68, $49, $FF, $69, $00, $D0, $0E, $A9, $04
.byte $C5, $1B, $90, $08, $A5, $29, $85, $D0, $A5, $2A, $85, $D1, $60

  LDA $E9
  AND #$FC
  ORA $0663
  STA $E9
  LDA RDNMI ; PpuStatus_2002
  
;   jslb reset_scroll_from_662, $a0
;   nops 8
  LDA $0662
  STA curr_hoff_low ; PpuScroll_2005
  
  LDA $0661
  STA curr_voff_low ; PpuScroll_2005
  
  
  jslb reset_ppu_control_values, $a0
  nops 1
;   LDA $E9
;   STA PpuControl_2000

  LDA $F4
  CMP #$02
  BNE :+
  LDA #$22
  STA VMADDH ; PpuAddr_2006
  LDA #$80
  STA VMADDL ; PpuAddr_2006
: RTS

;d99b
  LDA $E9
  AND #$FC
  ORA $0669
  STA $E9
  LDA RDNMI ; PpuStatus_2002

  LDA $0667
  STA curr_hoff_low ; PpuScroll_2005

  LDA $0668
  STA curr_voff_low ; PpuScroll_2005

  jslb reset_ppu_control_values, $a0
  nops 1
;   LDA $E9
;   STA PpuControl_2000

  RTS

.byte $A5, $3A, $8D, $63, $06, $A5, $E6
.byte $8D, $61, $06, $A5, $E7, $8D, $62, $06, $AD, $F4, $00, $C9, $02, $D0, $12, $AD
.byte $64, $06, $8D, $67, $06, $AD, $65, $06, $8D, $68, $06, $AD, $66, $06, $8D, $69
.byte $06, $60, $A9, $00, $85, $D0, $85, $D1, $85, $D2, $85, $D3, $20, $F3, $D9, $20
.byte $6D, $D9, $60, $A2, $03, $B5, $D0, $95, $D4, $CA, $10, $F9, $A5, $3C, $05, $3D


; DA00 - bank 7
.byte $10, $48, $A5, $3C, $25, $3D, $30, $12, $A0, $00, $B9, $3C, $00, $30, $02, $A0
.byte $01, $20, $4B, $DA, $20, $8B, $DA, $4C, $1D, $DA, $20, $3A, $DB, $A0, $00, $20
.byte $34, $DE, $A0, $02, $20, $34, $DE, $A5, $29, $85, $D0, $A5, $2A, $85, $D1, $A5
.byte $2B, $85, $D2, $A5, $2C, $85, $D3, $20, $AD, $DF, $AD, $F6, $FF, $29, $20, $D0
.byte $06, $20, $8D, $DD, $20, $0B, $DD, $20, $DA, $DE, $60, $A5, $D0, $18, $69, $40
.byte $85, $29, $A5, $D1, $69, $00, $85, $2A, $B9, $77, $00, $38, $E5, $29, $B9, $80
.byte $00, $E5, $2A, $10, $04, $20, $EA, $DA, $60, $A5, $D0, $18, $69, $C0, $85, $29
.byte $A5, $D1, $69, $00, $85, $2A, $A5, $29, $38, $F9, $77, $00, $A5, $2A, $F9, $80
.byte $00, $10, $04, $20, $02, $DB, $60, $20, $D8, $DA, $60, $B9, $92, $00, $18, $79
.byte $AD, $00, $85, $2B, $B9, $9B, $00, $79, $B6, $00, $85, $2C, $A5, $D2, $18, $69
.byte $90, $85, $FC, $A5, $D3, $69, $00, $85, $FD, $A5, $FC, $38, $E5, $2B, $A5, $FD
.byte $E5, $2C, $10, $04, $20, $14, $DB, $60, $A5, $D2, $18, $69, $50, $85, $FC, $A5
.byte $D3, $69, $00, $85, $FD, $A5, $2B, $38, $E5, $FC, $A5, $2C, $E5, $FD, $10, $04
.byte $20, $2A, $DB, $60, $20, $E1, $DA, $60, $A5, $D0, $85, $29, $A5, $D1, $85, $2A
.byte $60, $A5, $D2, $85, $2B, $A5, $D3, $85, $2C, $60, $B9, $77, $00, $38, $E9, $40
.byte $85, $29, $B9, $80, $00, $E9, $00, $85, $2A, $10, $06, $A9, $00, $85, $29, $85


; DB00 - bank 7
.byte $2A, $60, $B9, $77, $00, $38, $E9, $C0, $85, $29, $B9, $80, $00, $E9, $00, $85
.byte $2A, $30, $E8, $60, $A5, $2B, $38, $E9, $90, $85, $2B, $A5, $2C, $E9, $00, $85
.byte $2C, $10, $06, $A9, $00, $85, $2B, $85, $2C, $60, $A5, $2B, $38, $E9, $50, $85
.byte $2B, $A5, $2C, $E9, $00, $85, $2C, $30, $EA, $60, $A5, $77, $38, $E5, $78, $85
.byte $FC, $A5, $80, $E5, $81, $85, $FD, $10, $03, $20, $A3, $DB, $A5, $FD, $D0, $0F
.byte $A5, $FC, $C9, $7E, $B0, $09, $20, $B5, $DB, $20, $4B, $DA, $4C, $62, $DB, $20
.byte $D8, $DA, $A5, $92, $18, $65, $AD, $85, $FC, $A5, $9B, $65, $B6, $85, $FD, $A5
.byte $93, $18, $65, $AE, $85, $FE, $A5, $9C, $65, $B7, $85, $FF, $A5, $FE, $38, $E5
.byte $FC, $85, $FC, $A5, $FF, $E5, $FD, $85, $FD, $10, $03, $20, $A3, $DB, $A5, $FD
.byte $D0, $0D, $A5, $FC, $C9, $3E, $B0, $07, $20, $E9, $DB, $20, $8B, $DA, $60, $20
.byte $E1, $DA, $60, $A5, $FC, $49, $FF, $18, $69, $01, $85, $FC, $A5, $FD, $49, $FF
.byte $69, $00, $85, $FD, $60, $A5, $77, $38, $E5, $D0, $85, $FC, $49, $FF, $85, $FD
.byte $A5, $78, $38, $E5, $D0, $85, $FE, $49, $FF, $85, $FF, $A2, $03, $B5, $FC, $C9
.byte $40, $90, $06, $CA, $10, $F7, $A0, $00, $60, $E0, $02, $90, $08, $CA, $CA, $D5
.byte $FC, $B0, $02, $E8, $E8, $8A, $4A, $A8, $60, $A5, $92, $18, $65, $AD, $38, $E5
.byte $D2, $85, $FC, $49, $FF, $85, $FD, $A5, $93, $18, $65, $AE, $38, $E5, $D2, $85


; DC00 - bank 7
.byte $FE, $49, $FF, $85, $FF, $A2, $02, $B5, $FC, $C9, $60, $90, $09, $E0, $00, $F0
.byte $12, $A2, $00, $4C, $07, $DC, $E0, $02, $D0, $24, $D5, $FA, $90, $20, $A2, $00
.byte $4C, $3E, $DC, $A2, $03, $B5, $FC, $C9, $50, $90, $09, $E0, $01, $F0, $05, $A2
.byte $01, $4C, $25, $DC, $E0, $03, $D0, $06, $D5, $FA, $90, $02, $A2, $01, $8A, $4A
.byte $A8, $60, $A2, $00, $A0, $01, $A5, $34, $10, $0E, $A5, $3C, $25, $3D, $30, $26
.byte $B5, $3C, $30, $04, $A2, $01, $A0, $00, $B5, $77, $99, $77, $00, $B5, $80, $99
.byte $80, $00, $B5, $92, $99, $92, $00, $B5, $9B, $99, $9B, $00, $B5, $AD, $99, $AD
.byte $00, $B5, $B6, $99, $B6, $00, $60, $A2, $03, $BD, $D0, $00, $9D, $D4, $00, $CA
.byte $10, $F7, $A9, $00, $85, $19, $85, $29, $85, $2A, $85, $2B, $85, $2C, $A0, $00
.byte $B9, $3C, $00, $10, $05, $E6, $19, $20, $A7, $DE, $C8, $C0, $02, $90, $F1, $A5
.byte $19, $F0, $67, $C9, $02, $D0, $08, $46, $2A, $66, $29, $46, $2C, $66, $2B, $A5
.byte $29, $38, $E9, $80, $85, $29, $A5, $2A, $E9, $00, $85, $2A, $10, $06, $A9, $00
.byte $85, $29, $85, $2A, $A5, $2B, $38, $E9, $60, $85, $2B, $A5, $2C, $E9, $00, $85
.byte $2C, $10, $06, $A9, $00, $85, $2B, $85, $2C, $A0, $00, $20, $34, $DE, $A0, $02
.byte $20, $34, $DE, $A5, $29, $8D, $D0, $00, $A5, $2A, $8D, $D1, $00, $A5, $2B, $8D
.byte $D2, $00, $A5, $2C, $8D, $D3, $00, $20, $AD, $DF, $AD, $F6, $FF, $29, $20, $D0


; DD00 - bank 7
.byte $06, $20, $8D, $DD, $20, $0B, $DD, $20, $DA, $DE, $60, $AD, $B0, $04, $85, $19
.byte $46, $19, $B0, $1B, $AD, $D4, $00, $38, $ED, $D0, $00, $AD, $D5, $00, $ED, $D1
.byte $00, $B0, $0C, $AD, $D4, $00, $8D, $D0, $00, $AD, $D5, $00, $8D, $D1, $00, $46
.byte $19, $B0, $1B, $AD, $D0, $00, $38, $ED, $D4, $00, $AD, $D1, $00, $ED, $D5, $00
.byte $B0, $0C, $AD, $D4, $00, $8D, $D0, $00, $AD, $D5, $00, $8D, $D1, $00, $46, $19
.byte $B0, $1B, $AD, $D2, $00, $38, $ED, $D6, $00, $AD, $D3, $00, $ED, $D7, $00, $B0
.byte $0C, $AD, $D6, $00, $8D, $D2, $00, $AD, $D7, $00, $8D, $D3, $00, $46, $19, $B0
.byte $1B, $AD, $D6, $00, $38, $ED, $D2, $00, $AD, $D7, $00, $ED, $D3, $00, $B0, $0C
.byte $AD, $D6, $00, $8D, $D2, $00, $AD, $D7, $00, $8D, $D3, $00, $60, $AD, $D0, $00
.byte $38, $ED, $A8, $04, $AD, $D1, $00, $ED, $A9, $04, $B0, $1B, $AD, $D0, $00, $38
.byte $ED, $D4, $00, $AD, $D1, $00, $ED, $D5, $00, $B0, $0C, $AD, $A8, $04, $8D, $D0
.byte $00, $AD, $A9, $04, $8D, $D1, $00, $AD, $AA, $04, $38, $ED, $D0, $00, $AD, $AB
.byte $04, $ED, $D1, $00, $B0, $1B, $AD, $D4, $00, $38, $ED, $D0, $00, $AD, $D5, $00
.byte $ED, $D1, $00, $B0, $0C, $AD, $AA, $04, $8D, $D0, $00, $AD, $AB, $04, $8D, $D1
.byte $00, $AD, $D2, $00, $38, $ED, $AC, $04, $AD, $D3, $00, $ED, $AD, $04, $B0, $1B
.byte $AD, $D2, $00, $38, $ED, $D6, $00, $AD, $D3, $00, $ED, $D7, $00, $B0, $0C, $AD


; DE00 - bank 7
.byte $AC, $04, $8D, $D2, $00, $AD, $AD, $04, $8D, $D3, $00, $AD, $AE, $04, $38, $ED
.byte $D2, $00, $AD, $AF, $04, $ED, $D3, $00, $B0, $19, $AD, $D6, $00, $38, $ED, $D2
.byte $00, $AD, $D7, $00, $ED, $D3, $00, $AD, $AE, $04, $8D, $D2, $00, $AD, $AF, $04
.byte $8D, $D3, $00, $60, $B9, $D4, $00, $38, $F9, $29, $00, $99, $2D, $00, $B9, $D5
.byte $00, $F9, $2A, $00, $99, $2E, $00, $08, $10, $21, $A9, $FF, $59, $2D, $00, $99
.byte $2D, $00, $A9, $FF, $59, $2E, $00, $99, $2E, $00, $A9, $01, $18, $79, $2D, $00
.byte $99, $2D, $00, $B9, $2E, $00, $69, $00, $99, $2E, $00, $B9, $2E, $00, $D0, $0C
.byte $B9, $2D, $00, $F0, $30, $A9, $08, $D9, $2D, $00, $10, $29, $28, $08, $10, $14
.byte $A9, $03, $18, $79, $D4, $00, $99, $29, $00, $B9, $D5, $00, $69, $00, $99, $2A
.byte $00, $4C, $A5, $DE, $B9, $D4, $00, $38, $E9, $03, $99, $29, $00, $B9, $D5, $00
.byte $E9, $00, $99, $2A, $00, $68, $60, $B9, $77, $00, $18, $65, $29, $85, $29, $B9
.byte $80, $00, $65, $2A, $85, $2A, $B9, $92, $00, $18, $65, $2B, $85, $2B, $B9, $9B
.byte $00, $65, $2C, $85, $2C, $B9, $4A, $00, $30, $0F, $B9, $AD, $00, $18, $65, $2B
.byte $85, $2B, $B9, $B6, $00, $65, $2C, $85, $2C, $60, $AD, $D0, $00, $85, $E7, $A9
.byte $00, $85, $2F, $85, $30, $85, $2B, $85, $2C, $AD, $D2, $00, $18, $69, $EF, $85
.byte $29, $AD, $D3, $00, $69, $00, $85, $2A, $A2, $09, $A5, $2A, $38, $E9, $F0, $85


; DF00 - bank 7
.byte $2D, $A5, $2C, $E9, $00, $85, $2E, $90, $08, $A5, $2D, $85, $2A, $A5, $2E, $85
.byte $2C, $26, $2F, $06, $29, $26, $2A, $26, $2C, $CA, $D0, $DE, $46, $2C, $66, $2A
.byte $A9, $EF, $38, $E5, $2A, $85, $E6, $A5, $2F, $29, $01, $0A, $49, $02, $85, $3A
.byte $A5, $F4, $C9, $02, $D0, $76, $AD, $D0, $00, $38, $ED, $F5, $00, $85, $19, $AD
.byte $D1, $00, $E9, $00, $85, $1A, $AD, $D2, $00, $38, $ED, $F6, $00, $85, $1B, $AD
.byte $D3, $00, $E9, $00, $85, $1C, $A5, $19, $8D, $64, $06, $A9, $00, $85, $2F, $85
.byte $30, $85, $2B, $85, $2C, $A5, $1B, $18, $69, $EF, $85, $29, $A5, $1C, $69, $00
.byte $85, $2A, $A2, $09, $A5, $2A, $38, $E9, $F0, $85, $2D, $A5, $2C, $E9, $00, $85
.byte $2E, $90, $08, $A5, $2D, $85, $2A, $A5, $2E, $85, $2C, $26, $2F, $06, $29, $26
.byte $2A, $26, $2C, $CA, $D0, $DE, $46, $2C, $66, $2A, $A9, $EF, $38, $E5, $2A, $8D
.byte $65, $06, $A5, $2F, $29, $01, $0A, $49, $02, $8D, $66, $06, $60, $AD, $D0, $00
.byte $85, $2D, $AD, $D1, $00, $85, $2E, $AD, $D2, $00, $85, $2F, $AD, $D3, $00, $85
.byte $30, $20, $C4, $E0, $A9, $00, $85, $19, $20, $59, $E0, $90, $1D, $AD, $D4, $00
.byte $85, $2D, $AD, $D5, $00, $85, $2E, $AD, $D6, $00, $85, $2F, $AD, $D7, $00, $85
.byte $30, $20, $C4, $E0, $20, $59, $E0, $20, $EB, $DF, $60, $A0, $00, $38, $AD, $D0
.byte $00, $F1, $29, $C8, $AD, $D1, $00, $F1, $29, $B0, $0C, $88, $B1, $29, $8D, $D0


; E000 - bank 7
.byte $00, $C8, $B1, $29, $8D, $D1, $00, $C8, $38, $B1, $29, $ED, $D0, $00, $C8, $B1
.byte $29, $ED, $D1, $00, $B0, $0C, $88, $B1, $29, $8D, $D0, $00, $C8, $B1, $29, $8D
.byte $D1, $00, $C8, $38, $AD, $D2, $00, $F1, $29, $C8, $AD, $D3, $00, $F1, $29, $B0
.byte $0C, $88, $B1, $29, $8D, $D2, $00, $C8, $B1, $29, $8D, $D3, $00, $C8, $38, $B1
.byte $29, $ED, $D2, $00, $C8, $B1, $29, $ED, $D3, $00, $B0, $0C, $88, $B1, $29, $8D
.byte $D2, $00, $C8, $B1, $29, $8D, $D3, $00, $60, $A9, $00, $85, $19, $A0, $00, $38
.byte $A5, $2D, $F1, $29, $C8, $A5, $2E, $F1, $29, $C8, $B0, $04, $A9, $01, $85, $19
.byte $38, $B1, $29, $E5, $2D, $C8, $B1, $29, $E5, $2E, $C8, $B0, $04, $A9, $01, $85
.byte $19, $38, $A5, $2F, $F1, $29, $C8, $A5, $30, $F1, $29, $C8, $B0, $04, $A9, $01
.byte $85, $19, $38, $B1, $29, $E5, $2F, $C8, $B1, $29, $E5, $30, $C8, $B0, $04, $A9
.byte $01, $85, $19, $A5, $19, $F0, $1B, $98, $18, $65, $29, $85, $29, $A5, $2A, $69
.byte $00, $85, $2A, $A0, $00, $B1, $29, $C8, $31, $29, $30, $04, $20, $59, $E0, $60
.byte $38, $60, $18, $60, $AD, $22, $04, $0A, $A8, $B9, $FD, $E0, $85, $29, $B9, $FE
.byte $E0, $85, $2A, $A5, $2F, $85, $2B, $AD, $30, $00, $85, $2C, $20, $FE, $C8, $A5
.byte $05, $0A, $0A, $18, $65, $2E, $A8, $B1, $29, $85, $29, $A9, $00, $85, $2A, $A5
.byte $29, $18, $69, $6C, $85, $29, $A5, $2A, $69, $E1, $85, $2A, $60, $1D, $E1, $29


; E100 - bank 7
.byte $E1, $31, $E1, $32, $E1, $42, $E1, $43, $E1, $4B, $E1, $4F, $E1, $50, $E1, $51
.byte $E1, $52, $E1, $53, $E1, $54, $E1, $5C, $E1, $5C, $E1, $6C, $E1, $00, $00, $0A
.byte $00, $00, $00, $14, $00, $00, $00, $14, $00, $1E, $1E, $1E, $1E, $1E, $1E, $1E
.byte $1E, $30, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A, $3A
.byte $3A, $3A, $00, $54, $54, $54, $54, $54, $54, $54, $54, $66, $66, $66, $66, $30
.byte $30, $30, $30, $30, $70, $70, $70, $70, $70, $70, $70, $70, $00, $00, $00, $00
.byte $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00, $FF, $02
.byte $00, $00, $00, $00, $FF, $FF, $00, $02, $FF, $02, $00, $00, $DF, $01, $FF, $FF
.byte $00, $02, $FF, $02, $00, $00, $DF, $01, $FF, $FF, $00, $00, $80, $02, $F0, $00
.byte $F0, $00, $00, $00, $FF, $00, $00, $00, $F0, $00, $FF, $FF, $00, $00, $00, $00
.byte $00, $00, $00, $00, $FF, $FF, $00, $01, $00, $03, $00, $00, $00, $00, $00, $01
.byte $00, $01, $00, $00, $E0, $01, $00, $00, $00, $01, $E0, $01, $E0, $01, $FF, $FF
.byte $00, $00, $FF, $03, $EF, $00, $F0, $00, $60, $00, $FF, $01, $00, $00, $F0, $00
.byte $FF, $FF, $00, $00, $FF, $01, $00, $00, $00, $00, $FF, $FF, $FF, $01, $FF, $02
.byte $00, $00, $00, $00, $FF, $01, $00, $02, $00, $00, $F0, $00, $00, $00, $00, $02
.byte $F0, $00, $F0, $00, $FF, $FF, $00, $00, $00, $00, $00, $00, $00, $00, $FF, $FF


; E200 - bank 7
.byte $00, $00, $00, $00, $00, $00, $00, $00, $FF, $FF, $00, $00, $00, $00, $00, $00
.byte $00, $00, $FF, $FF

  JSR $FCC0
  JSR $FEA8
  JSR $E798

  ; palette updates, sets them all to black
  LDA RDNMI ; PpuStatus_2002

  jslb zero_all_palette_long, $a0
  rts

  @audio_hijack_8000:
  JSR $8000
  nops 4 
  ; jslb convert_audio, $a0
  rts

  @audio_hijack_8006:
  JSR $8006
  nops 4 
  ; jslb convert_audio, $a0
  rts

  @audio_hijack_8009:
  JSR $8009
  nops 4 
  ; jslb convert_audio, $a0
  rts

  nops 1

; using some of these for returning from NMI
@exit_from_nmi:
  PLA
  TAY
  PLA
  TAX
  PLA
;   RTI
  jml return_from_nes_nmi


;   LDA #$3F
;   STA PpuAddr_2006
;   LDA #$00
;   STA PpuAddr_2006
;   LDY #$00
;   LDA #$0F
; : STA PpuData_2007
;   INY
;   CPY #$20
;   BCC :-

;   LDA #$3F
;   STA PpuAddr_2006
;   LDA #$00
;   STA PpuAddr_2006
;   STA PpuAddr_2006
;   STA PpuAddr_2006

;   RTS

; e247 - Apperas to be palette update logic
  LDA $048F
  CMP $0491
  BEQ :+++
  LDA #$20
  JSR $E2E6
  BCC :+
  JMP $E2E5
: LDA $048F
  STA $0491
  ASL A
  TAX
  LDA $E2FA,X
  STA $29
  LDA $E2FB,X
  STA $2A
  LDX $05BC
  LDA #$3F
  STA $04B1,X
  INX
  LDA #$00
  STA $04B1,X
  INX
  LDA #$00
  STA $04B1,X
  INX
  LDA #$10
  STA $04B1,X
  INX
  LDY #$00
: LDA ($29),Y
  STA PALETTE_UPDATE_START, Y ;$04B1,X
  INX
  INY
  CPY #$10
  BCC :-
  STX $05BC
: LDA $0490
  CMP $0492
  BEQ @early_rts_from_palette
  LDA #$20
  JSR $E2E6
  BCC :+
  JMP $E2E5
: LDA $0490
  STA $0492
  ASL A
  TAX
  LDA $E360,X
  STA $29
  LDA $E361,X
  STA $2A
  LDX $05BC
  LDA #$3F
  STA $04B1,X
  LDA #$10
  INX
  STA $04B1,X
  LDA #$00
  INX
  STA $04B1,X
  INX
  LDA #$10
  STA $04B1,X
  INX
  LDY #$00
: LDA ($29),Y
  STA PALETTE_UPDATE_START + $10, Y ; $04B1,X
  INX
  INY
  CPY #$10
  BCC :-
  jsr @finish_palette_updates ; STX $05BC
@early_rts_from_palette:
  RTS

.byte $85, $19, $AD, $BB, $05, $38, $ED, $BC, $05, $F0
.byte $07, $38, $E5, $19, $B0, $02, $38, $60, $18, $60, $88, $E3, $98, $E3, $A8, $E3


; E300 - bank 7
.byte $B8, $E3, $C8, $E3, $D8, $E3, $E8, $E3, $F8, $E3, $08, $E4, $18, $E4, $28, $E4
.byte $38, $E4, $48, $E4, $58, $E4, $68, $E4, $78, $E4, $78, $E4, $78, $E4, $88, $E4
.byte $98, $E4, $A8, $E4, $B8, $E4, $C8, $E4, $D8, $E4, $E8, $E4, $F8, $E4, $38, $E5
.byte $F8, $E4, $48, $E5, $58, $E5, $68, $E5, $78, $E5, $88, $E5, $98, $E5, $A8, $E5
.byte $B8, $E5, $C8, $E5, $D8, $E5, $E8, $E5, $F8, $E5, $F8, $E5, $08, $E6, $18, $E6
.byte $28, $E6, $38, $E6, $08, $E5, $18, $E5, $28, $E5, $48, $E6, $58, $E6, $68, $E6
.byte $78, $E6, $88, $E6, $98, $E6, $A8, $E6, $A8, $E6, $B8, $E6, $C8, $E6, $D8, $E6
.byte $E8, $E6, $F8, $E6, $08, $E7, $08, $E7, $18, $E7, $28, $E7, $38, $E7, $48, $E7
.byte $58, $E7, $68, $E7, $78, $E7, $88, $E7, $0F, $07, $16, $28, $0F, $03, $13, $20
.byte $0F, $11, $22, $20, $0F, $08, $18, $28, $0F, $08, $18, $28, $0F, $02, $12, $22
.byte $0F, $03, $13, $32, $0F, $09, $1A, $2A, $0F, $08, $18, $28, $0F, $0C, $1C, $20
.byte $0F, $01, $11, $21, $0F, $09, $19, $29, $0F, $03, $13, $23, $0F, $02, $12, $22
.byte $0F, $0C, $1C, $3C, $0F, $07, $17, $27, $0F, $03, $13, $23, $0F, $02, $12, $22
.byte $0F, $0C, $1C, $3C, $0F, $07, $17, $27, $0F, $09, $19, $29, $0F, $21, $3C, $30
.byte $0F, $01, $11, $21, $0F, $08, $18, $28, $0F, $08, $18, $28, $0F, $0C, $00, $20
.byte $0F, $06, $16, $26, $0F, $03, $13, $23, $0F, $08, $18, $28, $0F, $0C, $00, $10


; E400 - bank 7
.byte $0F, $07, $17, $27, $0F, $02, $12, $22, $0F, $08, $18, $28, $0F, $0C, $00, $10
.byte $0F, $07, $17, $27, $0F, $02, $12, $22, $0F, $08, $18, $28, $0F, $0C, $00, $10
.byte $0F, $07, $17, $27, $0F, $02, $12, $22, $0F, $08, $18, $28, $0F, $0C, $00, $10
.byte $0F, $07, $17, $27, $0F, $02, $12, $22, $0F, $08, $18, $28, $0F, $0C, $00, $10
.byte $0F, $07, $17, $27, $0F, $02, $12, $22, $0F, $12, $21, $3B, $0F, $13, $23, $30
.byte $0F, $08, $18, $28, $0F, $02, $12, $21, $0F, $07, $17, $27, $0F, $00, $10, $30
.byte $0F, $01, $11, $21, $0F, $08, $18, $28, $0F, $07, $17, $27, $0F, $04, $14, $34
.byte $0F, $08, $18, $28, $0F, $19, $29, $39, $0F, $27, $16, $07, $0F, $38, $22, $02
.byte $0F, $39, $29, $19, $0F, $30, $10, $00, $0F, $09, $19, $29, $0F, $30, $21, $3C
.byte $0F, $01, $11, $21, $0F, $08, $18, $28, $0F, $09, $19, $29, $0F, $3C, $30, $21
.byte $0F, $01, $11, $21, $0F, $08, $18, $28, $0F, $07, $17, $27, $0F, $10, $30, $00
.byte $0F, $01, $11, $21, $0F, $08, $18, $28, $0F, $07, $17, $27, $0F, $30, $00, $10
.byte $0F, $01, $11, $21, $0F, $08, $18, $28, $0F, $03, $13, $23, $0F, $02, $12, $22
.byte $0F, $0C, $1C, $3C, $0F, $27, $07, $17, $0F, $03, $13, $23, $0F, $02, $12, $22
.byte $0F, $0C, $1C, $3C, $0F, $17, $27, $07, $0F, $27, $36, $16, $0F, $36, $17, $07
.byte $0F, $27, $16, $12, $0F, $27, $16, $06, $0F, $27, $36, $16, $0F, $22, $17, $07


; E500 - bank 7
.byte $0F, $27, $16, $12, $0F, $27, $16, $06, $0F, $27, $36, $16, $0F, $12, $17, $07
.byte $0F, $27, $16, $12, $0F, $27, $16, $06, $0F, $27, $36, $16, $0F, $02, $17, $07
.byte $0F, $27, $16, $12, $0F, $27, $16, $06, $0F, $27, $36, $16, $0F, $0F, $17, $07
.byte $0F, $27, $16, $12, $0F, $27, $16, $06, $0F, $27, $36, $16, $0F, $22, $17, $07
.byte $0F, $36, $21, $11, $0F, $07, $16, $02, $0F, $36, $27, $16, $0F, $22, $17, $16
.byte $0F, $32, $22, $12, $0F, $27, $16, $06, $0F, $00, $10, $20, $0F, $16, $36, $27
.byte $0F, $07, $16, $27, $0F, $12, $22, $32, $0F, $07, $16, $27, $0F, $16, $36, $27
.byte $0F, $15, $25, $27, $0F, $12, $22, $27, $0F, $27, $36, $16, $0F, $36, $17, $07
.byte $0F, $36, $18, $08, $0F, $34, $22, $15, $0F, $07, $16, $27, $0F, $16, $36, $27
.byte $0F, $07, $36, $17, $0F, $12, $22, $16, $0F, $07, $16, $27, $0F, $16, $36, $27
.byte $0F, $07, $36, $17, $0F, $26, $22, $17, $0F, $03, $12, $23, $0F, $07, $17, $26
.byte $0F, $03, $10, $00, $0F, $2A, $22, $23, $0F, $3C, $29, $19, $0F, $3C, $26, $17
.byte $0F, $3C, $17, $19, $0F, $00, $22, $19, $0F, $01, $12, $2C, $0F, $02, $12, $23
.byte $0F, $03, $13, $23, $0F, $1A, $22, $23, $0F, $15, $22, $27, $0F, $15, $30, $27
.byte $0F, $12, $30, $27, $0F, $04, $22, $15, $0F, $1A, $29, $16, $0F, $1A, $29, $36
.byte $0F, $16, $26, $36, $0F, $1B, $22, $30, $0F, $07, $16, $27, $0F, $16, $36, $27


; E600 - bank 7
.byte $0F, $02, $12, $22, $0F, $12, $22, $27, $0F, $25, $38, $3A, $0F, $16, $14, $19
.byte $0F, $2C, $30, $27, $0F, $26, $22, $17, $0F, $16, $02, $27, $0F, $16, $36, $27
.byte $0F, $16, $05, $27, $0F, $26, $31, $17, $0F, $07, $37, $16, $0F, $16, $36, $27
.byte $0F, $03, $13, $23, $0F, $16, $03, $27, $0F, $3C, $3C, $3C, $0F, $30, $26, $16
.byte $0F, $3C, $3C, $3C, $0F, $3C, $3C, $17, $0F, $28, $16, $06, $0F, $30, $21, $02
.byte $0F, $39, $29, $19, $0F, $30, $10, $00, $0F, $30, $0F, $0F, $0F, $21, $0F, $0F
.byte $0F, $11, $0F, $0F, $0F, $01, $0F, $0F, $0F, $0C, $1C, $2C, $0F, $0F, $13, $23
.byte $0F, $0F, $08, $18, $0F, $0F, $02, $12, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $26, $37, $0F, $0F, $1C, $2C, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $06, $16, $26, $0F, $0F, $1A, $37, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $14, $25, $0F, $0F, $16, $37, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $20, $16, $0F, $0F, $2C, $20, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $00, $26, $0F, $0F, $16, $26, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $17, $27, $0F, $0F, $1B, $27, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $19, $26, $0F, $0F, $19, $29, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $01, $12, $0F, $0F, $36, $00, $0F, $0F, $16, $36, $0F, $0F, $12, $22


; E700 - bank 7
.byte $0F, $0F, $30, $15, $0F, $0F, $20, $21, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $14, $24, $0F, $0F, $23, $33, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $30, $15, $0F, $07, $16, $27, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $17, $28, $0F, $0F, $13, $23, $0F, $30, $28, $18, $0F, $30, $28, $27
.byte $0F, $30, $38, $28, $0F, $21, $01, $11, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $1A, $26, $0F, $0F, $00, $30, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $20, $25, $0F, $0F, $20, $21, $0F, $30, $28, $18, $0F, $30, $28, $27
.byte $0F, $30, $38, $28, $0F, $0F, $0F, $0F, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $10, $00, $0F, $02, $12, $22, $0F, $0F, $16, $36, $0F, $0F, $12, $22
.byte $0F, $0F, $38, $17, $0F, $0F, $23, $13

; e798 - set vram increment to 1 and store

  jslb set_vram_increment_to_1_and_store, $a0
  RTS
  nops 5
;   LDA $E9
;   AND #$FB
;   STA PpuControl_2000
;   STA $E9
;   RTS

.byte $AD, $FF, $BF, $48, $20, $3E, $D8, $A9, $FC, $8D, $A7, $04, $A9, $00
.byte $85, $0B, $85, $0D, $A6, $0B, $BD, $3C, $00, $10, $0C, $29, $10, $D0, $08, $A6
.byte $0D, $A5, $0B, $95, $04, $E6, $0D, $E6, $0B, $A5, $0B, $C9, $07, $90, $E5, $A5
.byte $0D, $D0, $03, $4C, $67, $E8, $C6, $0D, $F0, $34, $A5, $0D, $85, $0B, $A9, $00
.byte $85, $0C, $A6, $0C, $B4, $04, $B5, $05, $AA, $B9, $92, $00, $38, $F5, $92, $B9
.byte $9B, $00, $F5, $9B, $B0, $0C, $A6, $0C, $B5, $04, $48, $B5, $05, $95, $04, $68


; E800 - bank 7
.byte $95, $05, $E6, $0C, $A5, $0C, $C5, $0B, $90, $D8, $C6, $0B, $D0, $D0, $A9, $00
.byte $85, $0E, $A6, $0E, $B4, $04, $84, $1A, $B9, $BF, $00, $AA, $0A, $A8, $98, $48
.byte $8A, $A8, $B9, $23, $EB, $20, $1D, $FF, $68, $A8, $B9, $00, $80, $85, $2B, $B9
.byte $01, $80, $85, $2C, $05, $2B, $F0, $27, $A6, $0E, $B4, $04, $B9, $C7, $00, $29
.byte $80, $4A, $85, $1B, $B9, $C7, $00, $29, $7F, $C9, $7F, $F0, $12, $0A, $A8, $B1
.byte $2B, $85, $29, $C8, $B1, $2B, $85, $2A, $05, $29, $F0, $03, $20, $6C, $E8, $E6
.byte $0E, $A5, $0D, $C5, $0E, $B0, $AB, $68, $20, $1D, $FF, $60, $AD, $A7, $04, $F0
.byte $22, $A0, $00, $B1, $29, $0A, $AA, $C8, $BD, $85, $E8, $85, $2B, $BD, $86, $E8
.byte $85, $2C, $6C, $2B, $00, $93, $E8, $94, $E8, $A1, $E8, $B3, $E8, $C5, $E8, $E0
.byte $E8, $0B, $E9, $60, $B1, $29, $85, $1C, $C8, $B1, $29, $85, $1D, $C8, $4C, $E1
.byte $E9, $B1, $29, $85, $1C, $C8, $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $C8
.byte $4C, $2E, $EA, $20, $8E, $E9, $18, $65, $1D, $A8, $B1, $29, $C8, $85, $1D, $20
.byte $80, $E9, $4C, $E1, $E9, $20, $8E, $E9, $06, $1D, $18, $65, $1D, $A8, $B1, $29
.byte $85, $2B, $C8, $B1, $29, $85, $2C, $C8, $20, $80, $E9, $A0, $00, $4C, $2E, $EA
.byte $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $C8, $84, $1E, $20, $80, $E9, $A5
.byte $29, $48, $A5, $2B, $85, $29, $A5, $2A, $48, $A5, $2C, $85, $2A, $20, $6C, $E8


; E900 - bank 7
.byte $68, $85, $2A, $68, $85, $29, $A0, $00, $4C, $71, $E8, $B1, $29, $85, $1E, $C8
.byte $98, $48, $A4, $1A, $B9, $4A, $04, $29, $7F, $A8, $B9, $BF, $00, $A8, $B9, $A7
.byte $E9, $A6, $1A, $B4, $BF, $C0, $02, $90, $0F, $A4, $1A, $B9, $4A, $04, $29, $7F
.byte $A8, $B9, $BF, $00, $A8, $B9, $C4, $E9, $C9, $FF, $F0, $3D, $0A, $85, $1D, $68
.byte $18, $65, $1D, $A8, $B1, $29, $85, $2B, $C8, $B1, $29, $85, $2C, $20, $80, $E9
.byte $A6, $1A, $BD, $4A, $04, $10, $1F, $A5, $2B, $05, $2C, $F0, $19, $A5, $29, $48
.byte $A5, $2B, $85, $29, $A5, $2A, $48, $A5, $2C, $85, $2A, $20, $6C, $E8, $68, $85
.byte $2A, $68, $85, $29, $A0, $00, $4C, $71, $E8, $68, $20, $80, $E9, $4C, $71, $E8
.byte $A5, $1E, $18, $65, $29, $85, $29, $A5, $2A, $69, $00, $85, $2A, $60, $B1, $29
.byte $85, $1C, $C8, $B1, $29, $85, $1E, $C8, $98, $48, $A5, $1A, $AA, $BC, $BF, $00
.byte $B9, $A7, $E9, $85, $1D, $68, $60, $00, $01, $00, $01, $04, $00, $00, $00, $00
.byte $00, $03, $00, $02, $00, $00, $00, $00, $00, $02, $00, $03, $01, $04, $00, $00
.byte $00, $00, $00, $00, $00, $01, $00, $00, $00, $00, $00, $00, $00, $00, $00, $00
.byte $02, $00, $00, $00, $00, $00, $FF, $FF, $FF, $01, $FF, $00, $FF, $FF, $FF, $00
.byte $FF, $B1, $29, $85, $2D, $C8, $B1, $29, $85, $2E, $C8, $B1, $29, $85, $2F, $C8
.byte $B1, $29, $85, $30, $C8, $84, $1E, $20, $80, $E9, $A9, $00, $85, $0B, $85, $0C


; EA00 - bank 7
.byte $A4, $0B, $AE, $A7, $04, $B1, $2D, $9D, $01, $02, $A5, $1D, $45, $1B, $9D, $02
.byte $02, $20, $7B, $EA, $B0, $0B, $AD, $A7, $04, $38, $E9, $04, $8D, $A7, $04, $F0
.byte $0A, $E6, $0C, $E6, $0C, $E6, $0B, $C6, $1C, $D0, $D5, $4C, $71, $E8, $B1, $29
.byte $85, $2D, $C8, $B1, $29, $85, $2E, $C8, $B1, $29, $85, $2F, $C8, $B1, $29, $85
.byte $30, $C8, $84, $1E, $20, $80, $E9, $A9, $00, $85, $0B, $85, $0C, $A4, $0B, $AE
.byte $A7, $04, $B1, $2D, $9D, $01, $02, $B1, $2B, $45, $1B, $9D, $02, $02, $20, $7B
.byte $EA, $B0, $0B, $AD, $A7, $04, $38, $E9, $04, $8D, $A7, $04, $F0, $0A, $E6, $0C
.byte $E6, $0C, $E6, $0B, $C6, $1C, $D0, $D5, $4C, $71, $E8, $A4, $0C, $B1, $2F, $20
.byte $19, $EB, $C9, $00, $08, $A4, $1A, $18, $79, $77, $00, $85, $1F, $B9, $80, $00
.byte $69, $00, $28, $10, $03, $18, $69, $FF, $85, $20, $A5, $1F, $38, $E9, $04, $85
.byte $1F, $A5, $20, $E9, $00, $85, $20, $A5, $1F, $38, $ED, $D0, $00, $85, $1F, $A5
.byte $20, $ED, $D1, $00, $30, $61, $D0, $5F, $A5, $1F, $9D, $03, $02, $A4, $1A, $B9
.byte $92, $00, $18, $79, $AD, $00, $85, $1F, $B9, $9B, $00, $79, $B6, $00, $85, $20
.byte $A5, $1F, $18, $69, $13, $85, $1F, $A5, $20, $69, $00, $85, $20, $A4, $0C, $C8
.byte $B1, $2F, $08, $18, $65, $1F, $85, $1F, $A5, $20, $69, $00, $28, $10, $03, $18
.byte $69, $FF, $85, $20, $A5, $1F, $38, $ED, $D2, $00, $85, $1F, $A5, $20, $ED, $D3


; EB00 - bank 7
.byte $00, $85, $20, $D0, $12, $30, $10, $A5, $1F, $C9, $48, $90, $0A, $A9, $FF, $38
.byte $E5, $1F, $9D, $00, $02, $18, $60, $38, $60, $24, $1B, $50, $05, $49, $FF, $18
.byte $69, $01, $60, $03, $03, $03, $03, $03, $03, $03, $03, $03, $01, $03, $03, $03
.byte $03, $03, $03, $03, $01, $01, $03, $01, $01, $01, $01, $01, $01, $01, $03, $01
.byte $01, $01, $03, $7A, $7B, $7C, $1A, $00, $46, $64, $88, $89, $8A, $8B, $8C, $1A
.byte $48, $8A, $48, $98, $48, $20, $52, $FE, $20, $70, $C6, $20, $38, $F6, $E6, $F1

  jslb set_ppu_mask_to_stored_value, $a0
  nop
;   LDA $E8
;   STA PpuMask_2001

.byte $20, $7B, $FD, $20, $34, $FC, $4C, $21, $EC, $48, $8A
.byte $48, $98, $48, $A5, $F0, $30, $21, $A5, $F0, $09, $80, $85, $F0, $20, $70, $C6
.byte $20, $67, $F3, $20, $9F, $F4, $20, $1F, $F5, $20, $38, $F6, $20, $7B, $FD, $20
.byte $34, $FC, $E6, $F1, $A9, $00, $85, $F0, $4C, $21, $EC, $48, $8A, $48, $98, $48
.byte $20, $52, $FE, $A5, $EB, $48, $AD, $FF, $BF, $48

  jslb set_ppu_mask_to_stored_value, $a0
  nop
;   LDA $E8
;   STA PpuMask_2001

  LDA RDNMI ; PpuStatus_2002
  LDA RDNMI ; PpuStatus_2002

.byte $A5, $F0, $30, $5B, $A5, $F0, $09, $80, $85, $F0, $20
.byte $70, $C6, $A5, $F3, $10, $08, $29, $7F, $85, $F4, $A9, $00, $85, $F3, $A5, $F4
.byte $F0, $1A, $A0, $00, $84, $F2, $C9, $01, $F0, $06, $C9, $03, $F0, $02, $D0, $06
.byte $20, $DD, $EC, $4C, $F7, $EB, $20, $9B, $D9, $4C, $F7, $EB

  LDA #$00
  STA VMADDH ;  PpuAddr_2006
  STA VMADDL ; PpuAddr_2006

.byte $20, $6D, $D9, $E6, $F1, $A4, $F4, $B9, $28, $EC, $A2, $80


; EC00 - bank 7
.byte $D0, $03, $B9, $2E, $EC

  LDX $EA
  STA $C000
  STA SCANLINE_FOR_IRQ ; $C001
  STA $E000,X


.byte $A9, $00, $85, $F0, $68, $20, $1D, $FF, $68, $85, $EB, $8D, $00, $80, $20, $A0
.byte $D0

  JMP @exit_from_nmi
  nops 3
;   PLA
;   TAY
;   PLA
;   TAX
;   PLA
;   RTI


.byte $00, $B8, $48, $A0, $B0, $00, $00, $BC, $48
.byte $A0, $B0, $00, $00, $48, $8A, $48, $98, $48, $8D, $00, $E0, $8D, $01, $E0, $A5
.byte $EB, $48, $AD, $FF, $BF, $48, $A5, $F4, $0A, $AA, $BD, $64, $EC, $85, $F7, $BD
.byte $65, $EC, $85, $F8, $6C, $F7, $00, $68, $20, $1D, $FF, $68, $85, $EB, $8D, $00
.byte $80, $4C, $21, $EC, $6C, $EC, $7D, $EC, $B7, $EC, $7D, $EC, $8D, $00, $E0, $A2
.byte $0C, $CA, $D0, $FD, $20, $E0, $F5, $20, $34, $FC, $4C, $57, $EC, $A5, $F2, $D0
.byte $28, $A6, $F4, $A9, $80, $D0, $0A, $AD, $2E, $EC, $38, $FD, $2E, $EC, $4C, $98
.byte $EC, $AD, $28, $EC, $38, $FD, $28, $EC, $8D, $00, $C0, $8D, $01, $C0, $8D, $01
.byte $E0, $20, $6D, $D9, $E6, $F2, $4C, $57, $EC, $8D, $00, $E0, $E6, $F2, $20, $E0
.byte $F5, $20, $34, $FC, $4C, $57, $EC, $A5, $F2, $D0, $16, $A9, $18, $A2, $80, $D0
.byte $02, $A9, $1C, $8D, $00, $C0, $8D, $01, $C0, $20, $11, $F6, $E6, $F2, $4C, $57
.byte $EC, $8D, $00, $E0, $20, $E0, $F5, $20, $34, $FC, $4C, $57, $EC


; ecdd - freeze scrolling for helicopter fight
  LDA $F4
  CMP #$01
  BEQ :+
  CMP #$03
  BEQ :+
  JMP $ED07
: 
  ; sets the main nametable for BG to $2000
  ; this will be taken care of by our scrolling routing
  ; so we dont' have to do store it.
  LDA $E9
  AND #$FC
  ORA $0663
  STA $E9

  LDA RDNMI ; PpuStatus_2002

  
;   jslb set_scroll_for_frame_freeze, $a0
;   nops 7
  LDA $F5
  STA curr_hoff_low ; PpuScroll_2005

  LDA $0661
  STA curr_voff_low ; PpuScroll_2005

  ; this is the storing we don't have to do
;   LDA $E9
;   STA PpuControl_2000
  nops 5
  
  RTS

; ED00 - bank 7
.byte $C9, $02, $D0, $01, $60, $60, $78, $D8, $20
.byte $A8, $FE, $A9, $06, $20, $1D, $FF, $A9, $00, $8D, $6A, $06, $85, $F3, $85, $F4
.byte $A9, $FF, $8D, $6B, $06, $20, $75, $F6, $20, $A8, $FE, $20, $C0, $FC, $20, $75
.byte $D8, $20, $A8, $FE, $20, $6B, $D8, $A2, $34, $20, $F9, $D7, $A9, $00, $A2, $02
.byte $A0, $07, $20, $5E, $FD, $A9, $01, $8D, $35, $04, $A2, $00, $AC, $02, $01, $B9
.byte $00, $01, $95, $17, $C8, $E8, $E0, $02, $90, $F5, $A9, $00, $85, $34, $85, $35
.byte $8D, $34, $04, $8D, $22, $04, $A9, $01, $8D, $35, $04, $A9, $00, $20, $20, $FC
.byte $20, $1F, $EF, $20, $4E, $F0, $20, $E9, $F2, $20, $DF, $F3, $20, $AA, $FA, $A5
.byte $35, $29, $FD, $85, $35, $20, $28, $EE, $A9, $00, $85, $F1, $20, $A2, $E7, $20
.byte $E4, $EE, $A5, $35, $30, $40, $A5, $34, $29, $08, $D0, $03, $20, $92, $FC, $20
.byte $AD, $DF, $20, $D0, $D6, $20, $F3, $D9, $20, $B0, $B1, $20, $DA, $DE, $20, $70
.byte $BA, $20, $14, $BC, $20, $41, $BD, $20, $30, $A5, $20, $25, $88, $20, $74, $FC
.byte $20, $43, $FC, $20, $20, $80, $20, $39, $D0, $A5, $F1, $C9, $01, $20, $4E, $C1
.byte $20, $B9, $D9, $20, $ED, $FE, $20, $47, $E2, $A5, $F1, $C9, $02, $90, $FA, $F0
.byte $08, $CD, $6A, $06, $90, $03, $8D, $6A, $06, $AD, $A5, $04, $8D, $A6, $04, $EE
.byte $A5, $04, $A5, $34, $29, $02, $D0, $0F, $A5, $35, $29, $01, $D0, $19, $A5, $35


; EE00 - bank 7
.byte $29, $04, $D0, $19, $4C, $88, $ED, $AD, $FE, $07, $29, $02, $F0, $03, $4C, $88
.byte $ED, $20, $93, $F0, $4C, $76, $ED, $20, $A8, $F1, $4C, $75, $FF, $20, $9C, $F2
.byte $4C, $76, $ED, $A5, $F1, $F0, $FC, $60, $20, $A8, $FE, $A5, $35, $29, $40, $D0
.byte $05, $A9, $00, $8D, $22, $04, $A9, $00, $8D, $23, $04, $85, $36, $85, $37, $8D
.byte $33, $04, $8D, $90, $04, $8D, $86, $04, $8D, $87, $04, $8D, $88, $04, $8D, $89
.byte $04, $8D, $8A, $04, $8D, $8B, $04, $A0, $04, $8C, $32, $04, $A5, $34, $29, $C0
.byte $85, $34, $A5, $35, $29, $80, $85, $35, $A5, $34, $10, $05, $A0, $04, $8C, $33
.byte $04, $A9, $00, $20, $20, $FC, $A9, $FF, $8D, $6B, $06, $20, $A8, $FE, $20, $00
.byte $88, $20, $6B, $D8, $20, $D3, $FC, $20, $3E, $D8, $20, $20, $C0, $AD, $8F, $04
.byte $8D, $91, $04, $20, $3E, $D8, $20, $C0, $FC, $20, $52, $FE, $20, $A8, $FE, $20
.byte $F3, $D9, $20, $6D, $D9

  LDA RDNMI ; PpuStatus_2002
  LDA RDNMI ; PpuStatus_2002


.byte $A9, $00, $85, $F0, $85
.byte $EA, $85, $F1, $A9, $19, $8D, $6C, $06, $20, $CA, $EE, $AE, $22, $04, $BD, $4B
.byte $95, $20, $20, $FC, $A9, $00, $8D, $3F, $06, $60, $A9, $00, $85, $F1, $A9, $C0
.byte $85, $EC, $20, $9C, $FE, $58, $A5, $F1, $C9, $01, $D0, $FA, $A9, $01, $85, $EA
.byte $20, $DD, $FC, $60, $20, $7B, $FD, $A5, $E0, $29, $10, $F0, $1A, $AD, $3F, $06
.byte $10, $15, $A0, $FF, $A5, $35, $49, $80, $85, $35, $10, $07, $A9, $FD, $20, $20


; EF00 - bank 7
.byte $FC, $A0, $39, $98, $20, $20, $FC, $60, $A5, $E8, $09, $01, $4C, $13, $EF, $A5
.byte $E8, $29, $FE, $85, $E8, $8D, $01, $20, $60, $A2, $58, $CA, $D0, $FD, $60, $20
.byte $80, $F6, $A9, $5C, $8D, $98, $04, $A9, $5E, $8D, $99, $04, $20, $ED, $FE, $20
.byte $A8, $FE, $A9, $0E, $8D, $90, $04, $20, $C0, $FC, $20, $75, $D8, $20, $14, $E2
.byte $A9, $2B, $20, $20, $CD, $20, $A9, $F5, $A9, $80, $D0, $0A, $AD, $F6, $FF, $10
.byte $05, $A9, $0B, $20, $9B, $F6, $A9, $00, $8D, $00, $A0, $20, $62, $F6, $A2, $08
.byte $A9, $00, $95, $3C, $CA, $10, $FB, $A9, $80, $85, $3E, $A9, $59, $85, $45, $A9
.byte $00, $85, $AF, $85, $B8, $85, $82, $85, $9D, $A9, $80, $85, $79, $A0, $66, $A9
.byte $80, $D0, $02, $A0, $7E, $84, $94, $20, $D3, $FC, $20, $43, $FC, $20, $A2, $E7
.byte $20, $C0, $FC, $20, $52, $FE, $20, $EA, $FC, $A9, $40, $85, $EC, $A9, $00, $85
.byte $F0, $20, $9C, $FE, $A9, $01, $20, $20, $FC, $A9, $80, $F0, $16, $D0, $14, $20
.byte $14, $E2, $20, $DD, $FC, $20, $BC, $F5, $20, $9C, $FE, $A9, $00, $8D, $2A, $04
.byte $4C, $EB, $EF, $20, $43, $FC, $20, $A2, $E7, $20, $D0, $D6, $A5, $45, $C9, $7F
.byte $F0, $0C, $A5, $F1, $C9, $01, $90, $FA, $A9, $00, $85, $F1, $F0, $E5, $20, $48
.byte $F0, $A9, $0A, $8D, $2A, $04, $A9, $04, $8D, $2B, $04, $20, $91, $FB, $AD, $2A
.byte $04, $F0, $13, $CE, $2B, $04, $D0, $0E, $A5, $E8, $49, $08, $85, $E8, $CE, $2A


; F000 - bank 7
.byte $04, $D0, $E3, $20, $48, $F0, $A5, $E0, $29, $D0, $F0, $DF, $A9, $01, $8D, $3F
.byte $06, $20, $91, $FB, $20, $D0, $D6, $AD, $3F, $06, $10, $F5, $A9, $00, $20, $20
.byte $FC, $A9, $01, $8D, $00, $A0, $60, $A5, $E8, $29, $E7, $85, $E8, $60, $A5, $E8
.byte $09, $18, $D0, $F7, $A5, $E8, $29, $EF, $4C, $2B, $F0, $A5, $E8, $09, $10, $D0
.byte $EA, $A5, $E8, $29, $F7, $4C, $2B, $F0, $A5, $E8, $09, $08, $D0, $DD, $A9, $80
.byte $F0, $40, $58, $20, $A8, $FE, $A9, $00, $8D, $BB, $05, $8D, $BC, $05, $20, $20
.byte $FC, $A9, $00, $8D, $90, $04, $A9, $30, $8D, $8F, $04, $20, $75, $D8, $20, $14
.byte $E2, $A2, $2C, $20, $88, $F6, $20, $C0, $FC, $20, $A8, $FE, $A9, $08, $20, $9B
.byte $F6, $20, $38, $F6, $20, $F7, $FC, $20, $BC, $F5, $A9, $14, $20, $6B, $FE, $20
.byte $DC, $F5, $60, $58, $20, $A8, $FE, $A9, $00, $8D, $BB, $05, $8D, $BC, $05, $20
.byte $20, $FC, $A9, $00, $8D, $90, $04, $A9, $30, $8D, $8F, $04, $20, $75, $D8, $20
.byte $14, $E2, $20, $80, $F6, $20, $C0, $FC, $20, $A8, $FE, $A9, $02, $20, $9B, $F6
.byte $20, $38, $F6, $20, $F7, $FC, $20, $BC, $F5, $A9, $00, $85, $FC, $85, $FD, $A9
.byte $60, $A0, $80, $D0, $02, $A9, $30, $8D, $A5, $04, $A9, $80, $85, $EC, $A9, $00
.byte $85, $F0, $20, $9C, $FE, $20, $91, $FB, $20, $10, $F1, $20, $91, $FB, $20, $10
.byte $F1, $20, $91, $FB, $20, $10, $F1, $CE, $A5, $04, $D0, $E9

; continue code input check
; screw codes, we'll let people continue
  LDA $FD
  CMP #$FF
  BRA :+  ; BEQ :+
  LDA #$80
  BEQ :+
  LDA $35
  AND #$BF
  STA $35
: JSR $F5DC
  RTS

; F110 - bank 7
.byte $A9, $80, $F0, $37, $A5, $35, $29, $40, $F0, $31, $A5, $FC, $C9, $FF, $F0, $2B
.byte $A5, $E0, $05, $E1, $F0, $25, $20, $4C, $F1, $B1, $29, $C5, $E0, $D0, $18, $C8
.byte $B1, $29, $C5, $E1, $D0, $11, $E6, $FC, $20, $4C, $F1, $B1, $29, $C8, $31, $29
.byte $C9, $FF, $D0, $07, $85, $FD, $60, $A9, $FF, $85, $FC, $60, $AE, $22, $04, $BD
.byte $62, $F1, $AA, $BD, $72, $F1, $85, $29, $BD, $73, $F1, $85, $2A, $A5, $FC, $0A
.byte $A8, $60, $00, $00, $00, $02, $02, $02, $02, $04, $04, $04, $04, $04, $04, $04
.byte $04, $04, $78, $F1, $86, $F1, $96, $F1, $08, $00, $01, $00, $04, $00, $02, $00
.byte $80, $00, $40, $00, $FF, $FF, $08, $00, $04, $00, $02, $00, $01, $00, $40, $00
.byte $80, $00, $80, $00, $FF, $FF, $00, $80, $00, $80, $00, $40, $00, $40, $00, $04
.byte $00, $08, $00, $01, $00, $02, $FF, $FF, $20, $A8, $FE, $78, $A9, $00, $8D, $BB
.byte $05, $8D, $BC, $05, $20, $20, $FC, $20, $75, $D8, $20, $14, $E2, $A9, $00, $85
.byte $FC, $85, $FD, $A9, $40, $85, $EC, $A9, $53, $20, $20, $FC, $20, $A8, $FE, $A4
.byte $FC, $B9, $84, $F2, $A2, $80, $D0, $03, $B9, $90, $F2, $85, $FF, $A9, $80, $D0
.byte $07, $B9, $78, $F2, $D0, $05, $F0, $3A, $B9, $6C, $F2, $20, $20, $CD, $20, $38
.byte $F6, $20, $2E, $F0, $A9, $00, $8D, $53, $06, $85, $F0, $20, $9C, $FE, $A9, $00


; F200 - bank 7
.byte $20, $7F, $FB, $20, $9C, $FB, $A5, $FC, $C9, $05, $D0, $03, $20, $27, $B1, $C6
.byte $FF, $D0, $F0, $A5, $FC, $C9, $0B, $F0, $44, $C9, $07, $F0, $36, $A9, $01, $20
.byte $7F, $FB, $E6, $FC, $A5, $FC, $C9, $06, $D0, $07, $A9, $07, $85, $FC, $4C, $CC
.byte $F1, $C9, $01, $D0, $97, $A9, $28, $85, $FF, $20, $9C, $FB, $A5, $FF, $C9, $14
.byte $D0, $0A, $A9, $00, $20, $20, $FC, $A9, $13, $20, $20, $FC, $C6, $FF, $D0, $E9
.byte $4C, $CC, $F1, $20, $C0, $AD, $A9, $09, $85, $FC, $4C, $CC, $F1, $A5, $E0, $29
.byte $10, $F0, $FA, $A9, $00, $20, $20, $FC, $20, $75, $D8, $60, $52, $32, $33, $34
.byte $35, $36, $37, $38, $00, $39, $53, $3A, $52, $00, $33, $34, $35, $36, $37, $38
.byte $00, $39, $53, $3A, $3C, $C8, $78, $C8, $C8, $64, $3C, $01, $01, $78, $78, $14
.byte $3C, $01, $FF, $D8, $D8, $74, $4C, $01, $01, $78, $78, $14, $58, $20, $A8, $FE
.byte $A9, $00, $8D, $BB, $05, $8D, $BC, $05, $20, $20, $FC, $A9, $00, $8D, $90, $04
.byte $A9, $30, $8D, $8F, $04, $20, $75, $D8, $20, $14, $E2, $20, $80, $F6, $20, $C0
.byte $FC, $20, $A8, $FE, $AE, $35, $04, $BD, $E7, $F2, $20, $9B, $F6, $20, $38, $F6
.byte $20, $F7, $FC, $20, $BC, $F5, $A9, $28, $20, $6B, $FE, $20, $DC, $F5, $A5, $35
.byte $29, $FB, $85, $35, $60, $05, $06, $09, $0A, $A5, $35, $29, $40, $F0, $77, $AE
.byte $22, $04, $BD, $9E, $95, $8D, $22, $04, $A5, $35, $09, $10, $85, $35, $A9, $00


; F300 - bank 7
.byte $20, $20, $FC, $20, $7B, $FD, $20, $A8, $FE, $20, $75, $D8, $20, $14, $E2, $20
.byte $80, $F6, $A9, $04, $20, $9B, $F6, $A9, $11, $8D, $90, $04, $A9, $30, $8D, $8F
.byte $04

; set palette for continue screen, we "fix" this
   LDA #$00 ; #$AA 

.byte $20, $80, $F4, $20, $38, $F6, $20, $9B, $F3, $20, $C0, $FC, $20
.byte $F7, $FC, $20, $BC, $F5, $A9, $01, $20, $20, $FC, $A9, $80, $85, $EC, $A9, $00
.byte $85, $F0, $20, $9C, $FE, $A9, $00, $85, $F1, $EE, $A5, $04, $20, $23, $EE, $A5
.byte $E0, $29, $10, $F0, $F0, $20, $A8, $FE, $A9, $FC, $20, $20, $FC, $20, $DC, $F5
.byte $A5, $35, $29, $EF, $85, $35, $60, $A5, $35, $29, $10, $F0, $2D, $A5, $E0, $4A
.byte $4A, $4A, $90, $0F, $A5, $35, $29, $40, $F0, $20, $A5, $35, $29, $BF, $85, $35
.byte $4C, $92, $F3, $4A, $90, $14, $A5, $35, $29, $40, $D0, $0E, $A5, $35, $09, $40
.byte $85, $35, $20, $9B, $F3, $A9, $49, $20, $20, $FC, $60, $A2, $00, $A0, $00, $A5
.byte $35, $29, $40, $F0, $02, $A0, $01, $20, $B3, $F3, $E8, $98, $49, $01, $A8, $20
.byte $B3, $F3, $60

  TXA
  ASL A
  TAX
  LDA RDNMI ; PpuStatus_2002
  LDA $F3D8,X
  STA VMADDH ; PpuAddr_2006
  LDA $F3D7,X
  STA VMADDL ; PpuAddr_2006
  LDA #$80
  BEQ :+
  LDA $F3DB,Y
  STA VMDATAL ; PpuData_2007
  RTS
:
  LDA $F3DD,Y
  STA VMDATAL ; PpuData_2007
  RTS

.byte  $0A, $21, $8A, $21, $00, $FF, $00, $FC, $A5
.byte $35, $09, $20, $85, $35, $A9, $00, $20, $20, $FC, $20, $7B, $FD, $20, $A8, $FE
.byte $20, $75, $D8, $20, $14, $E2, $20, $80, $F6, $A0, $01, $A9, $80, $D0, $02, $A0


; F400 - bank 7
.byte $00, $98, $20, $9B, $F6, $A9, $11, $8D, $90, $04, $A9, $30, $8D, $8F, $04
;  set palette for menu
LDA #$00 ; LDA #$AA
.byte $20, $80, $F4, $20, $38, $F6, $20, $C0, $FC, $20, $F7, $FC, $20, $BC, $F5
.byte $A9, $01, $20, $20, $FC, $A9, $80, $85, $EC, $A9, $00, $85, $F0, $20, $9C, $FE
.byte $A9, $00, $85, $F1, $EE, $A5, $04, $A5, $34, $29, $BF, $85, $34, $AE, $34, $04
.byte $A5, $34, $29, $3F, $1D, $7D, $F4, $85, $34, $20, $23, $EE, $A5, $E0, $29, $10
.byte $F0, $DE, $A9, $80, $F0, $15, $AC, $35, $04, $AD, $22, $04, $F0, $0D, $D9, $E4
.byte $94, $F0, $08, $90, $06, $B9, $E4, $94, $8D, $22, $04, $20, $A8, $FE, $A9, $FC
.byte $20, $20, $FC, $20, $DC, $F5, $A5, $35, $29, $DF, $85, $35, $60, $00, $80, $C0
.byte $A2, $00, $8E, $B1, $05, $A2, $3F, $9D, $BD, $05, $CA, $10, $FA, $20, $C0, $FC
.byte $20, $70, $C6, $20, $96, $C5, $AD, $BB, $05, $CD, $BC, $05, $D0, $EF, $60, $A5
.byte $35, $29, $20, $F0, $79, $A5, $E0, $4A, $90, $16, $A0, $80, $D0, $12, $AE, $35
.byte $04, $E0, $02, $B0, $0B, $A9, $00, $20, $6E, $F5, $EE, $35, $04, $4C, $19, $F5
.byte $4A, $90, $14, $A0, $80, $D0, $10, $AE, $35, $04, $F0, $0B, $A9, $00, $20, $6E
.byte $F5, $CE, $35, $04, $4C, $19, $F5, $4A, $90, $12, $AE, $34, $04, $E0, $02, $B0
.byte $0B, $A9, $00, $20, $4E, $F5, $EE, $34, $04, $4C, $19, $F5, $4A, $90, $10, $AE
.byte $34, $04, $F0, $2A, $A9, $00, $20, $4E, $F5, $CE, $34, $04, $4C, $19, $F5, $A5


; F500 - bank 7
.byte $E0, $29, $20, $F0, $19, $A9, $00, $20, $6E, $F5, $EE, $35, $04, $AD, $35, $04
.byte $C9, $03, $90, $05, $A9, $00, $8D, $35, $04, $A9, $49, $20, $20, $FC, $60, $A5
.byte $35, $29, $20, $F0, $28, $AD, $A5, $04, $29, $10, $F0, $17, $A9, $FF, $A0, $80
.byte $D0, $02, $A9, $FC, $20, $4E, $F5, $A9, $FF, $A0, $80, $D0, $02, $A9, $FC, $20
.byte $6E, $F5, $60, $A9, $00, $20, $4E, $F5, $A9, $00, $20, $6E, $F5, $60

; f54e
  PHA
  LDA $0434
  ASL A
  TAX
  LDA RDNMI ; PpuStatus_2002
  LDA $F569,X
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDA $F568,X
  STA VMADDL ; PpuAddr_2006
  PLA
  STA VMDATAL ; PpuData_2007
  RTS

.byte $09, $21, $49, $21, $89, $21

  PHA
  LDA $0435
  ASL A
  TAX
  LDA RDNMI ; PpuStatus_2002
  LDA #$80
  BEQ :+
  LDA $F59E,X
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDA $F59D,X
  STA VMADDL ; PpuAddr_2006
  PLA
  STA VMDATAL ; PpuData_2007
  RTS
:
  LDA $F5A4,X
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDA $F5A3,X
  STA VMADDL ; PpuAddr_2006
  PLA
  STA VMDATAL ; PpuData_2007
  RTS

.byte $49, $22, $89
.byte $22, $C9, $22, $04, $23, $0B, $23, $14, $23, $20, $47, $E2, $A2, $08, $8A, $48
.byte $20, $C0, $FC, $20, $70, $C6, $68, $AA, $CA, $10, $F3, $60, $A2, $00, $8E, $3F
.byte $06, $A0, $02, $98, $48, $20, $C0, $FC, $20, $52, $FE, $20, $70, $C6, $20, $D0
.byte $D6, $AD, $3F, $06, $10, $EF, $68, $A8, $88, $10, $E8, $60, $A2, $01, $D0, $DE
.byte $A5, $E9, $29, $FC, $0D, $63, $06, $49, $02, $85, $E9, $AD, $02, $20, $A9, $00
.byte $8D, $05, $20, $A9, $D0, $8D, $05, $20, $A5, $E9, $8D, $00, $20, $A2, $2B, $AD


; F600 - bank 7
.byte $63, $06, $29, $02, $F0, $02, $A2, $23, $8E, $06, $20, $A2, $00, $8E, $06, $20
.byte $60, $A5, $E9, $29, $FC, $0D, $63, $06, $85, $E9, $AD, $02, $20, $AD, $62, $06
.byte $8D, $05, $20, $A9, $F0, $8D, $05, $20, $A5, $E9, $8D, $00, $20, $A9, $2A, $8D
.byte $06, $20, $A9, $80, $8D, $06, $20, $60

  LDA RDNMI ; PpuStatus_2002
  LDA $E9
  AND #$FC
  jslb update_ppu_control_from_a_and_store, $a0
;   STA $E9
;   STA PpuControl_2000
  LDA #$00
  STA curr_hoff_low ; PpuScroll_2005
  STA curr_voff_low ; PpuScroll_2005
;   jslb reset_offsets, $a0
  RTS
  nops 1
;   nops 2

.byte $AD, $02, $20
.byte $A5, $E9, $29, $FC, $85, $E9, $8D, $00, $20, $A9, $00, $8D, $05, $20, $8D, $05
.byte $20, $60

  LDA RDNMI ; PpuStatus_2002
  LDA #$08
  jslb update_ppu_control_from_a_and_store, $a0
;   STA $E9
;   STA PpuControl_2000
  LDA #$00
  jslb simple_scrolling, $a0
;   STA PpuScroll_2005
;   STA PpuScroll_2005
  RTS
  nops 2
  nops 1

.byte $A2, $07, $A9, $00, $9D, $DC, $00, $CA, $10, $FA, $60
.byte $A2, $30, $A9, $80, $D0, $02, $A2, $24, $8E, $9C, $04, $E8, $8E, $9D, $04, $E8
.byte $8E, $9E, $04, $E8, $8E, $9F, $04, $20, $B4, $FE, $60

; f69b
  ASL A
  TAX
  LDA $F710,X
  STA $29
  LDA $F711,X
  STA $2A
  JSR $E798
  LDY #$00
  LDA RDNMI ; PpuStatus_2002
  INY
  LDA ($29),Y
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  DEY
  LDA ($29),Y
  STA VMADDL ; PpuAddr_2006
  INY
  INY
: LDA ($29),Y
  CMP #$01
  BNE :+
  INY
  JMP $F6AC
: CMP #$00
  BEQ :+
  JSR $F6D5
  STA VMDATAL ; PpuData_2007
  INY
  BNE :--
: RTS

.byte $C9, $20, $D0, $03, $A9, $00, $60, $C9, $21, $D0, $03
.byte $A9, $FA, $60, $C9, $2C, $D0, $03, $A9, $F7, $60, $C9, $2E, $D0, $03, $A9, $F6
.byte $60, $C9, $25, $D0, $03, $A9, $4A, $60, $C9, $30, $90, $08, $C9, $3A, $B0, $04


; F700 - bank 7
.byte $18, $69, $BA, $60, $C9, $41, $90, $07, $C9, $5B, $B0, $03, $18, $69, $8F, $60
.byte $28, $F7, $77, $F7, $DE, $F7, $EA, $F7, $2C, $F8, $3F, $F8, $4A, $F8, $53, $F8
.byte $5E, $F8, $18, $F9, $AF, $F9, $98, $FA, $88, $20, $44, $4F, $55, $42, $4C, $45
.byte $20, $20, $44, $52, $41, $47, $4F, $4E, $01, $0A, $21, $31, $50, $20, $50, $4C
.byte $41, $59, $01, $4A, $21, $32, $50, $20, $50, $4C, $41, $59, $20, $41, $01, $8A
.byte $21, $32, $50, $20, $50, $4C, $41, $59, $20, $42, $01, $05, $23, $45, $41, $53
.byte $59, $20, $20, $20, $4E, $4F, $52, $4D, $41, $4C, $20, $20, $20, $44, $49, $46
.byte $46, $49, $43, $55, $4C, $54, $00, $82, $20, $44, $4F, $55, $42, $4C, $45, $20
.byte $44, $52, $41, $47, $4F, $4E, $20, $25, $20, $20, $54, $48, $45, $20, $52, $45
.byte $56, $45, $4E, $47, $45, $01, $0A, $21, $31, $50, $20, $50, $4C, $41, $59, $01
.byte $4A, $21, $32, $50, $20, $50, $4C, $41, $59, $20, $41, $01, $8A, $21, $32, $50
.byte $20, $50, $4C, $41, $59, $20, $42, $01, $4A, $22, $50, $52, $41, $43, $54, $49
.byte $43, $45, $01, $8A, $22, $57, $41, $52, $52, $49, $4F, $52, $01, $CA, $22, $53
.byte $55, $50, $52, $45, $4D, $45, $20, $4D, $41, $53, $54, $45, $52, $00, $CB, $21
.byte $47, $41, $4D, $45, $20, $4F, $56, $45, $52, $00, $05, $21, $59, $4F, $55, $20
.byte $48, $41, $56, $45, $20, $43, $4F, $4D, $50, $4C, $45, $54, $45, $44, $01, $50


; F800 - bank 7
.byte $21, $4C, $45, $56, $45, $4C, $2E, $01, $05, $22, $54, $4F, $20, $43, $4F, $4E
.byte $54, $49, $4E, $55, $45, $01, $45, $22, $20, $53, $45, $4C, $45, $43, $54, $20
.byte $47, $41, $4D, $45, $20, $4C, $45, $56, $45, $4C, $2E, $00, $0B, $21, $43, $4F
.byte $4E, $54, $49, $4E, $55, $45, $01, $8B, $21, $53, $54, $41, $52, $54, $00, $47
.byte $21, $50, $52, $41, $43, $54, $49, $43, $45, $00, $49, $21, $4E, $4F, $56, $49
.byte $43, $45, $00, $46, $21, $20, $4D, $41, $53, $54, $45, $52, $20, $00, $A5, $20
.byte $20, $20, $20, $20, $20, $4C, $49, $43, $45, $4E, $53, $45, $44, $20, $54, $4F
.byte $01, $E4, $20, $41, $43, $43, $4C, $41, $49, $4D, $20, $45, $4E, $54, $45, $52
.byte $54, $41, $49, $4E, $4D, $45, $4E, $54, $20, $49, $4E, $43, $2E, $01, $25, $21
.byte $46, $4F, $52, $20, $54, $48, $45, $20, $55, $53, $41, $20, $41, $4E, $44, $20
.byte $43, $41, $4E, $41, $44, $41, $01, $66, $21, $42, $59, $20, $54, $45, $43, $48
.byte $4E, $4F, $53, $20, $4A, $41, $50, $41, $4E, $20, $43, $4F, $52, $50, $2E, $01
.byte $05, $22, $20, $20, $20, $20, $54, $4D, $20, $41, $4E, $44, $20, $FF, $20, $31
.byte $39, $38, $39, $01, $47, $22, $54, $45, $43, $48, $4E, $4F, $53, $20, $4A, $41
.byte $50, $41, $4E, $20, $43, $4F, $52, $50, $2E, $01, $A5, $22, $20, $20, $20, $20
.byte $20, $4C, $49, $43, $45, $4E, $53, $45, $44, $20, $42, $59, $01, $E5, $22, $4E


; F900 - bank 7
.byte $49, $4E, $54, $45, $4E, $44, $4F, $20, $4F, $46, $20, $41, $4D, $45, $52, $49
.byte $43, $41, $20, $49, $4E, $43, $2E, $00, $05, $21, $59, $4F, $55, $20, $48, $41
.byte $56, $45, $20, $43, $4F, $4D, $50, $4C, $45, $54, $45, $44, $20, $54, $48, $45
.byte $01, $45, $21, $50, $52, $41, $43, $54, $49, $43, $45, $20, $4C, $45, $56, $45
.byte $4C, $2E, $01, $85, $21, $4D, $41, $4E, $59, $20, $4D, $4F, $52, $45, $20, $45
.byte $4E, $45, $4D, $49, $45, $53, $20, $41, $4E, $44, $01, $C5, $21, $43, $48, $41
.byte $4C, $4C, $45, $4E, $47, $45, $53, $20, $41, $57, $41, $49, $54, $20, $59, $4F
.byte $55, $2E, $01, $24, $22, $43, $48, $41, $52, $47, $45, $20, $4F, $4E, $2C, $44
.byte $4F, $55, $42, $4C, $45, $20, $44, $52, $41, $47, $4F, $4E, $53, $2C, $01, $62
.byte $22, $54, $48, $45, $20, $57, $41, $52, $52, $49, $4F, $52, $20, $4C, $45, $56
.byte $45, $4C, $20, $41, $57, $41, $49, $54, $53, $20, $59, $4F, $55, $2E, $00, $C3
.byte $20, $57, $45, $4C, $4C, $20, $44, $4F, $4E, $45, $2C, $44, $4F, $55, $42, $4C
.byte $45, $20, $44, $52, $41, $47, $4F, $4E, $53, $2C, $01, $03, $21, $56, $45, $52
.byte $59, $20, $46, $45, $57, $20, $48, $41, $56, $45, $20, $45, $56, $45, $52, $20
.byte $4D, $41, $44, $45, $20, $49, $54, $01, $43, $21, $54, $4F, $20, $54, $48, $45
.byte $20, $45, $4E, $44, $20, $4F, $46, $20, $54, $48, $45, $20, $57, $41, $52, $52


; FA00 - bank 7
.byte $49, $4F, $52, $01, $83, $21, $4C, $45, $56, $45, $4C, $2E, $42, $55, $54, $20
.byte $4E, $4F, $57, $20, $59, $4F, $55, $52, $20, $47, $52, $45, $41, $54, $45, $53
.byte $54, $01, $C3, $21, $43, $48, $41, $4C, $4C, $45, $4E, $47, $45, $20, $49, $53
.byte $20, $41, $48, $45, $41, $44, $2E, $01, $23, $22, $54, $48, $45, $20, $4D, $41
.byte $53, $54, $45, $52, $20, $4C, $45, $56, $45, $4C, $20, $48, $41, $53, $20, $41
.byte $4E, $01, $63, $22, $45, $4E, $45, $4D, $59, $20, $53, $4F, $20, $45, $56, $49
.byte $4C, $2C, $4E, $4F, $20, $4F, $4E, $45, $20, $48, $41, $53, $01, $A3, $22, $45
.byte $56, $45, $52, $20, $53, $45, $45, $4E, $20, $48, $49, $4D, $20, $41, $4E, $44
.byte $20, $53, $55, $52, $56, $49, $56, $45, $44, $2E, $01, $EA, $22, $47, $4F, $4F
.byte $44, $20, $4C, $55, $43, $4B, $21, $00, $EA, $22, $53, $41, $4D, $50, $4C, $45
.byte $20, $56, $45, $52, $53, $49, $4F, $4E, $20, $00, $A5, $35, $09, $02, $85, $35
.byte $20, $A8, $FE, $78, $A9, $00, $85, $FC, $AE, $22, $04, $BD, $C6, $FB, $D0, $01
.byte $60, $85, $FD, $20, $A8, $FE, $A5, $35, $29, $02, $F0, $28, $AD, $22, $04, $F0
.byte $03, $4C, $72, $FB, $A4, $FC, $A9, $80, $F0, $0B, $B9, $B1, $FB, $85, $FF, $B9
.byte $A7, $FB, $4C, $ED, $FA, $B9, $C0, $FB, $85, $FF, $B9, $BA, $FB, $C9, $FF, $D0
.byte $2C, $4C, $72, $FB, $A5, $34, $29, $04, $F0, $09, $A5, $34, $29, $FB, $85, $34


; FB00 - bank 7
.byte $4C, $72, $FB, $AD, $22, $04, $0A, $AA, $BD, $D6, $FB, $85, $29, $BD, $D7, $FB
.byte $85, $2A, $A9, $C8, $85, $FF, $A4, $FC, $B1, $29, $20, $04, $FC, $20, $20, $CD
.byte $20, $38, $F6, $20, $2E, $F0, $A9, $40, $85, $EC, $A9, $00, $85, $F0, $20, $9C
.byte $FE, $A9, $0E, $20, $20, $FC, $A9, $00, $20, $7F, $FB, $A9, $00, $85, $F1, $A5
.byte $E0, $05, $E1, $29, $D0, $D0, $0A, $A5, $F1, $C9, $03, $90, $F2, $C6, $FF, $D0
.byte $EA, $85, $FE, $A9, $01, $20, $7F, $FB, $A5, $35, $29, $02, $F0, $0B, $A5, $FE
.byte $29, $10, $D0, $0E, $E6, $FC, $4C, $C3, $FA, $E6, $FC, $C6, $FD, $F0, $03, $4C
.byte $C3, $FA, $A9, $00, $20, $20, $FC, $20, $A8, $FE, $78, $20, $75, $D8, $60, $8D
.byte $3F, $06, $20, $91, $FB, $20, $D0, $D6, $AD, $3F, $06, $10, $F5, $20, $91, $FB
.byte $60, $A9, $00, $85, $F1, $A5, $F1, $C9, $01, $90, $FA, $60, $A9, $00, $85, $F1
.byte $A5, $F1, $C9, $03, $90, $FA, $60, $3D, $3E, $3F, $40, $4B, $4C, $4D, $49, $4A
.byte $FF, $FF, $78, $A0, $78, $28, $14, $14, $28, $A0, $3D, $4B, $4C, $4D, $49, $FF
.byte $FF, $78, $A0, $78, $28, $14, $01, $01, $02, $01, $00, $01, $01, $02, $00, $00
.byte $00, $00, $01, $02, $02, $00, $F6, $FB, $F7, $FB, $F8, $FB, $FA, $FB, $00, $00
.byte $FB, $FB, $FC, $FB, $FD, $FB, $00, $00, $00, $00, $00, $00, $00, $00, $FF, $FB
.byte $00, $FC, $02, $FC, $00, $00, $4A, $45, $3B, $3C, $44, $43, $42, $4E, $4F, $41


; FC00 - bank 7
.byte $50, $51, $31, $46, $C9, $46, $D0, $11, $A0, $48, $AD, $32, $04, $F0, $09, $A0
.byte $47, $AD, $33, $04, $F0, $02, $A0, $46, $98, $60, $C1, $59, $04, $00, $44, $59


; fc20 - start of sound routines
; play sound/music in A
  ; STA $07FF
  
  jsr @play_audio_hijack
  LDA $BFFF
  PHA
  LDA #$05
  JSR $FF1D
  JSR $8000
  PLA
  JSR $FF1D
  RTS


; sound routines
  LDA $BFFF
  PHA
  LDA #$05
  JSR $FF1D
  JSR @audio_hijack_8003 ; $8003
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$02
  JSR $FF1D
  JSR @audio_hijack_8000
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$04
  JSR $FF1D
  JSR @audio_hijack_8003
  JMP $FC2F

  LDA $BFFF
  PHA
  TXA
  PHA
  LDA #$04
  JSR $FF1D
  PLA
  TAX
  JSR @audio_hijack_8006
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$02
  JSR $FF1D
  JSR @audio_hijack_8003
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$04
  JSR $FF1D
  JSR @audio_hijack_8000
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$02
  JSR $FF1D
  JSR @audio_hijack_8006
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$02
  JSR $FF1D
  JSR @audio_hijack_8009
  JMP $FC2F

  LDA $BFFF
  PHA
  LDA #$06
  JSR $FF1D
  JSR $ABB0
  JMP $FC2F

.byte $70

; FCC0 - 
  PHA
  LDA $EC
  PHA
  LDA #$00
  STA $EC
    jslb enable_nmi_and_store, $a0
    nops 5
    ; LDA $E9
    ; ORA #$80
    ; STA $E9
    ; STA PpuControl_2000
:  BNE :-  ; infinite loop, iterrupted only by NMI
    LDA $E8
    AND #$E7
    jslb update_ppu_mask_and_store, $a0
    nops 1
    ; STA $E8
    ; STA PpuMask_2001
  RTS

.byte $A5, $E8, $09
.byte $18, $D0, $F4, $A5, $E8, $29, $EF, $4C, $D7, $FC, $A5, $E8, $09, $10, $D0, $E7
.byte $A5, $E8, $29, $F7, $4C, $D7, $FC, $A5, $E8, $09, $08, $D0, $DA, $AD, $02, $20


; FD00 - bank 7
.byte $A5, $E7, $8D, $05, $20, $A5, $E6, $8D, $05, $20, $A5, $E9, $8D, $00, $20, $60

; fd10
  STA $04
  STX $05
  STY $06
  LDA RDNMI ; PpuStatus_2002
    jslb set_vram_increment_to_1_and_store, $a0
    nops 5
    ; LDA $E9
    ; AND #$FB
    ; STA PpuControl_2000
    ; STA $E9
  LDA $04
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDY #$00
  STY VMADDL ; PpuAddr_2006
  LDX #$04
  CMP #$20
  BCS :+
  LDX $06
: LDY #$00
  LDA $05
: STA VMDATAL ; PpuData_2007
  DEY
  BNE :-
  DEX
  BNE :-
  LDY $06
  LDA $04
  CMP #$20
  BCC :++
  ADC #$02
  jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  LDA #$C0
  STA VMADDL ; PpuAddr_2006
  LDX #$40
: STY VMDATAL ; PpuData_2007
  DEX
  BNE :-
: LDX $05
  RTS

; fd5e
.byte $48, $8A
.byte $84, $05, $18, $E5, $05, $AA, $68, $A0, $00, $84, $04, $91, $04, $88, $D0, $FB
.byte $C6, $05, $E8, $D0, $F6, $60, $20, $E0, $FD, $F0, $06, $20, $E0, $FD, $20, $02
.byte $FE, $A2, $01, $B5, $E0, $A8, $55, $E2, $35, $E0, $95, $E0, $94, $E2, $CA, $10
.byte $F2, $60, $20, $E0, $FD, $A4, $E0, $A5, $E1, $48, $20, $E0, $FD, $68, $C5, $E1
.byte $D0, $F3, $C4, $E0, $D0, $EF, $F0, $D9, $20, $E0, $FD, $20, $02, $FE, $A4, $E0
.byte $A5, $E1, $48, $20, $E0, $FD, $20, $02, $FE, $68, $C5, $E1, $D0, $F0, $C4, $E0
.byte $D0, $EC, $F0, $BD, $20, $E0, $FD, $A5, $04, $85, $E2, $A5, $05, $85, $E3, $A2
.byte $03, $B5, $E0, $A8, $55, $DC, $35, $E0, $95, $E0, $94, $DC, $CA, $10, $F2, $60


; FDE0 - input reading
;   LDX $E5
;   INX
;   STX Ctrl1_4016
;   DEX
;   STX Ctrl1_4016
;   LDX #$08
; : LDA Ctrl1_4016
;   LSR A
;   ROL $E0
;   LSR A
;   ROL $04
;   LDA Ctrl2_FrameCtr_4017
;   LSR A
;   ROL $E1
;   LSR A
;   ROL $05
;   DEX
;   BNE :-
  jslb augment_input, $a0
  RTS
  nops 29


; FE00 - bank 7
.byte $A5, $04, $05, $E0, $85, $E0, $A5, $05, $05, $E1, $85, $E1, $60, $A9
.byte $15, $A2, $14, $A0, $16, $86, $04, $D6, $04, $10, $05, $A9, $09, $95, $04, $98
.byte $AA, $B5, $04, $F0, $02, $D6, $04, $CA, $E4, $04, $D0, $F5, $60, $8A, $48, $98
.byte $48, $A2, $17, $A0, $02, $B5, $00, $29, $02, $85, $04, $B5, $01, $29, $02, $45
.byte $04, $18, $F0, $01, $38, $76, $00, $E8, $88, $D0, $FA, $68, $A8, $68, $AA, $A5
.byte $17, $60

; NES OAM
; we handle this all ourselves
  RTS

  @audio_hijack_8003:
  JSR $8003
  nops 4
  ; jslb convert_audio, $a0
  rts
  nops 2
;   LDA #$00
;   STA OamAddr_2003
;   LDA #$02
;   STA SpriteDma_4014
;   RTS

.byte $A6, $04, $A2
.byte $FE, $EA, $CA, $D0, $FC, $C5, $04, $88, $D0, $F3, $60, $85, $13, $A5, $13, $29
.byte $F0, $F0, $18, $A0, $FA, $20, $5D, $FE, $20, $5D, $FE, $20, $5D, $FE, $20, $5D
.byte $FE, $A5, $13, $38, $E9, $10, $85, $13, $4C, $6D, $FE, $A5, $13, $29, $0F, $F0
.byte $0A, $A0, $64, $20, $5D, $FE, $38, $E9, $01, $D0, $F6, $60

; enable NMI
  PHA
  jslb enable_nmi_and_store, $a0
  nops 5
;   LDA $E9
;   ORA #$80
;   STA $E9
;   STA PpuControl_2000
  PLA
  RTS


; fea9 - disable and store NMI
  PHA
  jslb disable_nmi_and_store, $a0
  nops 5
;   LDA $E9
;   AND #$7F
;   STA $E9
;   STA PpuControl_2000
  PLA
  RTS

; load bank(s) to BG Tiles
; we're going to make an assumption, for now
; that $049c contains the first bank and we're always
; doing them in order.  so we can load a ful 0x1000 bank at once
LDA $049C
; LSR
; LSR
STA BG_CHR_BANK_SWITCH
jslb swap_data_bg_chr, $a0
rts

 nops 3
@audio_write_replacement:
jslb store_a_to_register_y, $a0
rts

@check_for_attributes:
  LDA $04B1,X
  PHA
  AND #$F3
  CMP #$23
  bne :+
  LDA $04B2, x
  CMP #$C0
  bcc :+
  LDA $1b
  SEC
  SBC #$2E
  bcc :+

  STA $1b
  PLA  
  ; attributes!
  ; handle them!
  jslb double_dragon_2_attribute_routine, $a0
  jmp @check_for_attributes
  ; attributes are always handled in
  ; 0x20 blocks
  ; so now we fake that we finished doing the whole loop
  ; TXA
  ; CLC
  ; ADC #$24
  ; STA $05BB
  ; TAX  
  ; LDA $04B1, x
  ; PHA
: PLA
  jmp @check_for_attributes_return

;   LDA #$82
;   STA $00EB
;   STA $8000
;   LDA $049C
;   STA $8001
;   LDA #$83
;   STA $00EB
;   STA $8000
;   LDA $049D
;   STA $8001
;   LDA #$84
;   STA $00EB
;   STA $8000
;   LDA $049E
;   STA $8001
;   LDA #$85
;   STA $00EB
;   STA $8000
;   LDA $049F
;   STA $8001
;   RTS

; feed - load sprite tileset(s)
  LDA $E9
  BPL :+
  LDA $00EC
  CMP #$C0
  BNE :+
  LDA $0498
  CMP #$40
  BEQ :+
  NOP 

  ; load first bank
: 
  jslb load_sprite_banks, $a0
  rts

  ; claiming free space!
@store_vm_add_h_to_range:
  jslb store_vmaddh_to_proper_range, $a0
  RTS

@audio_routine:
  NOP
  JSR $FC34

  NOP
  JSR $FF1D
  PLA
  STA $EB

;   LDA $0498
;   STA CHR_BANK_BANK_TO_LOAD
;   stz CHR_BANK_TARGET_BANK
;   jslb load_mmc3_bank_to_slot, $a0
  nops 5
;   LDA #$80
;   STA $00EB
;   STA $8000
;   LDA $0498
;   STA $8001

;   LDA $0499
;   STA CHR_BANK_BANK_TO_LOAD
;   INC CHR_BANK_TARGET_BANK
;   jslb load_mmc3_bank_to_slot, $a0
;   nops 13

  jmlb return_from_sound, $a0
;   LDA #$81
;   STA $00EB
;   STA $8000
;   LDA $0499
;   STA $8001

;   RTS

; ff1d - bank swap
  
  PHA
  
  LDA NMITIMEN_STATE
  AND #$7F
  STA NMITIMEN  
; nops 8

  PLA
  PHA
  AND #$0f
  INC
  ORA #$A0

  STA BANK_SWITCH_DB
  
  PHA
  LDA #<@bank_switch_jump
  STA BANK_SWITCH_LB
  LDA #>@bank_switch_jump
  STA BANK_SWITCH_HB
  JML (BANK_SWITCH_LB)

@bank_switch_jump: 
  PLB

  PLA
  PHA
  STA ACTIVE_NES_BANK
    
  jslb reset_nmi_status, $a0
; nops 4
  PLA
  RTS

  nops 1
@play_audio_hijack:
  jslb play_track_hijack, $b2
  rts

;   PHA
;   TXA
;   PHA
;   LDA #$87
;   STA $00EB
;   STA $8000
;   TSX
;   LDA $0102,X

;   ASL
;   ORA #$01
;   STA $8001
;   LDA #$86
;   STA $00EB
;   STA $8000

; : LDA $0102,X
;   ASL
;   STA $8001
;   PLA
;   TAX

;   PLA
;   CMP $BFFF
;   BNE :+
;   RTS

; : NOP
;   LDX $BFFF
;   BRA :--

@nes_nmi:
  BIT $EC
  BPL :++
  BVC :+
  JMP $EB9B  ; NE & V+
: JMP $EB6E  ; NE & V-
: BVC :+
  JMP $EB50  ; PL & V+
: jslb disable_nmi_and_store, $a0
  ; nops 5
;   LDA $E9    ; PL & V-
;   AND #$7F
;   STA $E9
;   STA PpuControl_2000
  LDA RDNMI ; PpuStatus_2002
  ; we pull 1 extra values from the stack here
  ; luckily we saved 5 instructions above
  nops 4
  PLA
  PLA
  PLA
  PLA
  PLA
  STA $EC
  PLA
  RTS

@nes_reset:
; NES initialization
  SEI
  ; stack setup, we already did this.
;   LDX #$FF
;   TXS
  nops 3

  jslb set_ppu_control_and_mask_to_0, $a0
  nops 4
;   LDA #$00
;   STA PpuControl_2000
;   STA PpuMask_2001


  LDA #$80
  BPL :+++
  LDX #$02
: BIT RDNMI ; PpuStatus_2002
  BPL :-
: BIT RDNMI ; PpuStatus_2002
  BMI :-
  DEX
  BNE :--

: 
  LDA #$08
;   STA PpuControl_2000 ; sets the Sprite table, we handle this in our own init.
  nops 3
  STA $E9


;   LDA #$01  ; sets mirroring to horizontal
;   STA $A000
  LDA #$01
  STA BANK_SWITCH_CTRL_REGS


  CLD
  LDA #$06

  jslb update_ppu_mask_and_store, $a0
  nops 1
;   STA $E8
;   STA PpuMask_2001

  LDX #$02
: LDA RDNMI ; PpuStatus_2002

  BPL :-
  DEX
  BNE :-

  STX $E7
  STX $E6
  STX $E5
  nops 3 ; STX Ctrl1_4016 ; strobe controllers
  LDA #$FF
  STA $E4

;   sets IRQ inhibit flag
  LDA #$40
  nops 3 ; STA Ctrl2_FrameCtr_4017

  LDA #$0F
  jsr WriteAPUControl ; STA ApuStatus_4015

  LDA #$10
  TAX
: jsr @store_vm_add_h_to_range ; STA VMADDH ; PpuAddr_2006
  STA VMADDL ; PpuAddr_2006
  EOR #$00
  DEX
  BNE :-
  LDA #$80
  STA $EC
  LDA #$C0
  STA $ED
  LDA #$00
  STA $F0
  nop
  JMP $ED0D

.byte $5C, $5D, $5E, $5F, $6D, $00, $C1, $C2, $C3
.byte $88, $89, $8A, $8B, $8C, $06, $00, $4C, $75, $FF, $50, $FF, $75, $FF, $34, $EC
